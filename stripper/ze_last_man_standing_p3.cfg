; - - - - - - - - - - - - - - - - - - - - - - - 
; 				  ze Last Man Standing
; 				 Map version "p3" (CS:GO)
; - - - - - - - - - - - - - - - - - - - - - - -

; Optional: Start at extreme.
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Mode_Extreme_Compare"
	}
	replace:
	{
		"InitialValue" "1"
	}
}

; - - - - - - - - - - - - - - - - - - - - - - -
; Changes done by "Hichatu".
; - - - - - - - - - - - - - - - - - - - - - - -

; Fix stage 2 skips in first room.
add:
{
	"classname" "func_brush"
	"model" "*219"
	"origin" "5158 879 -6818"
	"rendermode" "10"
}

add:
{
	"classname" "func_brush"
	"model" "*219"
	"origin" "4102 879 -6818"
	"rendermode" "10"
}

add:
{
	"classname" "func_brush"
	"model" "*223"
	"origin" "3893 1353 -6870"
	"rendermode" "10"
}

add:
{
	"classname" "func_brush"
	"model" "*223"
	"origin" "5173 1353 -6870"
	"rendermode" "10"
}

; Fix admin room teleport angles.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "adminroomtp"
	}
	replace:
	{
		"wait" "1e30"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetAngles(0, 180, 0);-1"
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector());-1"
	}
}

; Remake the "Team Win Ending".
; Delete the original condition for the stage 1 helicopter ending.
modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "stage_x_helicopter_6"
	}
	delete:
	{
		"OnPass" "Event_Status_Stage_x_helicopter_EscapesCompare0-1"
	}
}

filter:
{
	"classname" "logic_compare"
	"targetname" "Event_Status_Stage_x_helicopter_Escapes"
}

; Base it on the amount of events completed throughout the map by humans, when on stage 5.
; 10 events to be specific.
add:
{
	"classname" "math_counter"
	"targetname" "stage_5_teamwinending1"
	"max" "10"
	"OnHitMax" "!self,Kill,,,1"
	"OnHitMax" "Case_Events_Stage_5,InValue,stage_x_helicopter_escapes,,1"
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Case_Events_Stage_5"
		"origin" "-4272 11224 -8552"
	}
	insert:
	{
		"OnCase01" "stage_5_teamwinending1,Add,1,,1"
		"OnCase02" "stage_5_teamwinending1,Add,1,,1"
		"OnCase03" "stage_5_teamwinending1,Add,1,,1"
		"OnCase04" "stage_5_teamwinending1,Add,1,,1"
		"OnCase05" "stage_5_teamwinending1,Add,1,,1"
		"OnCase06" "stage_5_teamwinending1,Add,1,,1"
		"OnCase07" "stage_5_teamwinending1,Add,1,,1"
		"OnCase08" "stage_5_teamwinending1,Add,1,,1"
		"OnCase09" "stage_5_teamwinending1,Add,1,,1"
		"OnCase10" "stage_5_teamwinending1,Add,1,,1"
		"OnCase11" "stage_5_teamwinending1,Add,1,,1"
		"OnCase12" "stage_5_teamwinending1,Add,1,,1"
		"OnCase13" "stage_5_teamwinending1,Add,1,,1"
		"OnCase14" "stage_5_teamwinending1,Add,1,,1"
		"OnCase15" "stage_5_teamwinending1,Add,1,,1"
		"OnCase16" "stage_5_teamwinending1,Add,1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Case_Events_Stage_5"
		"origin" "-4272 11240 -8552"
	}
	insert:
	{
		"OnCase01" "stage_5_teamwinending1,Add,1,,1"
		"OnCase02" "stage_5_teamwinending1,Add,1,,1"
		"OnCase03" "stage_5_teamwinending1,Add,1,,1"
		"OnCase04" "stage_5_teamwinending1,Add,1,,1"
		"OnCase05" "stage_5_teamwinending1,Add,1,,1"
		"OnCase06" "stage_5_teamwinending1,Add,1,,1"
		"OnCase07" "stage_5_teamwinending1,Add,1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Case_Events_Stage_5"
		"origin" "-4256 11256 -8552"
	}
	insert:
	{
		"OnCase09" "stage_5_teamwinending1,Add,1,,1"
		"OnCase10" "stage_5_teamwinending1,Add,1,,1"
		"OnCase11" "stage_5_teamwinending1,Add,1,,1"
		"OnCase13" "stage_5_teamwinending1,Add,1,,1"
		"OnCase14" "stage_5_teamwinending1,Add,1,,1"
		"OnCase15" "stage_5_teamwinending1,Add,1,,1"
		"OnCase16" "stage_5_teamwinending1,Add,1,,1"
	}
}

; Fix possible skip with "Tank" vehicle on stage 4.
add:
{
	"classname" "func_brush"
	"model" "*142"
	"origin" "3640 972 3467"
	"rendermode" "10"
}

; Fix stage 1 skip after bridge.
add:
{
	"classname" "func_brush"
	"model" "*675"
	"origin" "5176 -9963 -12740"
	"rendermode" "10"
}

; Fix "Portal Gun" repeatedly teleporting bug.
modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "Weapon_PortalGun_Portal_1_Phys"
	}
	insert:
	{
		"OnUser1" "Weapon_PortalGun_Portal_1_Trigger,Kill,,,-1"
		"OnUser2" "Weapon_PortalGun_Portal_1_Trigger,ClearParent,,1.5,-1"
	}
}

modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "Weapon_PortalGun_Portal_2_Phys"
	}
	insert:
	{
		"OnUser1" "Weapon_PortalGun_Portal_2_Trigger,Kill,,,-1"
		"OnUser2" "Weapon_PortalGun_Portal_2_Trigger,ClearParent,,1.5,-1"
	}
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "Weapon_PortalGun_Portal_1_Trigger"
	"model" "*86"
	"spawnflags" "1"
	"origin" "-1088 13304 -8516"
	"parentname" "Weapon_PortalGun_Portal_1_Teleport"
	"StartDisabled" "1"
	"filtername" "Weapon_PortalGun_FixFilter_2"
	"wait" "1e30"
	"OnStartTouch" "!activator,AddContext,player_portal_1:1,,-1"
	"OnStartTouch" "Weapon_PortalGun_EnterPortalSound,FireUser1,,,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "Weapon_PortalGun_Portal_2_Trigger"
	"model" "*89"
	"spawnflags" "1"
	"origin" "-1088 13352 -8516"
	"parentname" "Weapon_PortalGun_Portal_2_Teleport"
	"StartDisabled" "1"
	"filtername" "Weapon_PortalGun_FixFilter_1"
	"wait" "1e30"
	"OnStartTouch" "!activator,AddContext,player_portal_2:1,,-1"
	"OnStartTouch" "Weapon_PortalGun_EnterPortalSound,FireUser1,,,-1"
}

add:
{
	"classname" "filter_activator_context"
	"targetname" "Weapon_PortalGun_FixFilter_1_2"
	"ResponseContext" "player_portal_1"
}

add:
{
	"classname" "filter_activator_context"
	"targetname" "Weapon_PortalGun_FixFilter_2_2"
	"ResponseContext" "player_portal_2"
}

modify:
{
	match:
	{
		"classname" "trigger_teleport"
		"targetname" "Weapon_PortalGun_Portal_1_Teleport"
	}
	replace:
	{
		"filtername" "Weapon_PortalGun_FixFilter_1_2"
	}
	delete:
	{
		"OnEndTouch" "Weapon_PortalGun_EnterPortalSoundFireUser10-1"
		"OnStartTouch" "!activatorAddContextplayer_portal_1:10-1"
		"OnEndTouch" "!activatorRemoveContextplayer_portal_20-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_teleport"
		"targetname" "Weapon_PortalGun_Portal_2_Teleport"
	}
	replace:
	{
		"filtername" "Weapon_PortalGun_FixFilter_2_2"
	}
	delete:
	{
		"OnEndTouch" "Weapon_PortalGun_EnterPortalSoundFireUser10-1"
		"OnEndTouch" "!activatorRemoveContextplayer_portal_10-1"
		"OnStartTouch" "!activatorAddContextplayer_portal_2:10-1"
	}
}

; Fix buggy train on stage 4.
modify:
{
	match:
	{
		"classname" "func_tanktrain"
		"targetname" "Vehicle_Fake_Truck_Tracktrain1"
	}
	replace:
	{
		"orientationtype" "1"
	}
}

modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "Vehicle_Fake_Truck_Path_Track_5"
	}
	insert:
	{
		"OnPass" "!activator,AddOutput,angles 0 180,,1"
	}
}

; - - - - - - - - - - - - - - - - - - - - - - -
; 	Changes done by "iszaar".
; - - - - - - - - - - - - - - - - - - - - - - -

; Humans don't need to trigger this on extreme stage 1 but zombies can still trigger it.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_1_button_end_2"
	}
	delete:
	{
		"OnPressed" "ZOMBIESTRIGGEREDRunScriptCodeprogressTrigger()01"
	}
}	

; Remove the push for camping.
filter:
{
	"classname" "trigger_push"
	"targetname" "extreme3antigaycamp"
}

; Fix delaying on stage 2.
modify:
{
	match:
	{
		"classname" "filter_activator_team"
		"targetname" "stage_2_end_check_zombie"
	}
	insert:
	{
		"OnPass" "Global_GameText_Announcement,FireUser3,,,1"
		"OnPass" "Global_GameText_Announcement,SetText,** ZOMBIES DETECTED! YOU LOSE! **,,1"
		"OnPass" "map1roundend1,EndRound_TerroristsWin,7,3,1"
	}
}

; Open doors to prevent zombies being locked out on "Solo Ending".
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_core_destroyed"
	}
	insert:
	{
		"OnTrigger" "stage_5_top_door_*,Open,,,1"
	}
}

; Make "Ultralisk" come faster on event he's not killed.
modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage5_things"
	}
	delete:
	{
		"OnEntitySpawned" "stage_5_lower_ultraliskTrigger120-1"
	}
	insert:
	{
		"OnEntitySpawned" "stage_5_lower_ultralisk,Trigger,,100,1"
	}
}

; Avoid delaying on stage 5.
modify:
{
	match:
	{
		"classname" "math_counter"
		"targetname" "stage_5_lower_counter_energy"
	}
	insert:
	{
		"OnHitMax" "stage_5_antidelay1,Trigger,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_5_lower_door_button_LIFT"
	}
	insert:
	{
		"OnPressed" "stage_5_antidelay1,Kill,,,1"
		"OnPressed" "stage_5_antidelay1,CancelPending,,,1"
	}
}

add:
{
	"classname" "logic_relay"
	"targetname" "stage_5_antidelay1"
	"OnTrigger" "Global_GameText_Announcement,FireUser3,,6,1"
	"OnTrigger" "Global_GameText_Announcement,SetText,** ACTIVATE THE ELEVATOR QUICKLY! (1/3) **,5,1"
	"OnTrigger" "Global_GameText_Announcement,FireUser3,,16,1"
	"OnTrigger" "Global_GameText_Announcement,SetText,** ACTIVATE THE ELEVATOR QUICKLY! (2/3) **,15,1"
	"OnTrigger" "Global_GameText_Announcement,FireUser3,,26,1"
	"OnTrigger" "Global_GameText_Announcement,SetText,** LAST WARNING! ACTIVATE THE ELEVATOR QUICKLY! (3/3) **,25,1"
	"OnTrigger" "map1roundend1,EndRound_TerroristsWin,7,35,1"
}

; Fix zombies being able to surf and stop stage 2 from being completed, only really doable with high air acceleration but just incase.
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_2_antistrafe1"
	"origin" "4608 -7232 -8864"
	"spawnflags" "1"
	"model" "*613"
	"StartDisabled" "1"
	"filtername" "team_filter_zombies"
	"wait" "1e30"
	"OnStartTouch" "!activatorRunScriptCodeif (self.GetTeam() == 2) self.SetVelocity(Vector(0, 0, self.GetVelocity().z));-1"
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_2_end_trigger"
	}
	insert:
	{
		"OnTrigger" "stage_2_antistrafe1,Enable,,1,1"
	}
}

; Make this unblockable, players can get stuck but at least this won't be griefable.
modify:
{
	match:
	{
		"classname" "func_tracktrain"
		"targetname" "stage_x_reward_vehicle_with_weapons"
	}
	replace:
	{
		"dmg" "5"
	}
}

; Lower delay on the buttons on top of stage 5.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "/stage_x_end_button_(blue|red)/"
	}
	replace:
	{
		"wait" ".01"
	}
}

; Stage 4 nuke breaking will now not cause map to be in limbo to avoid delay, uses "OnUser1" because we don't want it to be damaged early.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_4_end_button_protection"
	}
	insert:
	{
		"OnUser1" "stage_4_nuke_broke,Enable,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "stage_x_ultralistk_path_8"
	}
	insert:
	{
		"OnPass" "stage_4_nuke_broke,Trigger,,,1"
	}
}

add:
{
	"classname" "logic_relay"
	"targetname" "stage_4_nuke_broke"
	"spawnflags" "1"
	"StartDisabled" "1"
	"OnTrigger" "Global_GameText_Announcement,FireUser3,,2,1"
	"OnTrigger" "Global_GameText_Announcement,SetText,** THE NUKE FAILED! **,2,1"
	"OnTrigger" "Global_GameText_Announcement,FireUser3,,8,1"
	"OnTrigger" "Global_GameText_Announcement,SetText,** THE ULTRALISK IS STILL ALIVE HOPE WE DON'T HAVE TO MEET HIM AGAIN... **,8,1"
	"OnTrigger" "stage_end_explosion_working,Trigger,,10,1"
}

; Nerf "Antlion" item, this was done due to it being overpowered if you know what to do.
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Zombie_Item_Antlion_Dig_Relay"
	}
	delete:
	{
		"OnEqualTo" "Global_SpeedModifySpeed1.151.25-1"
	}
	insert:
	{
		"OnEqualTo" "Global_Speed,ModifySpeed,.5,1.25,-1"
	}
}

; Move stage 1 "Vortigaunt" item spawn place to let you get past easier with "Tank" vehicle.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Extreme_stage_1"
	}
	delete:
	{
		"OnTrigger" "Zombie_Item_Vortigaunt_TemplateAddOutputorigin 7886 2884 -13662-1"
	}
	insert:
	{
		"OnTrigger" "Zombie_Item_Vortigaunt_Template,SetLocalOrigin,7886 3108 -13662,,-1"
	}
}

; Fix boost on stage 5 with core.
modify:
{
	match:
	{
		"classname" "trigger_teleport"
		"targetname" "stage_5_core_hit_push"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector());-1"
	}
}

; Reset zombie falling velocity on stage 5 solo ending fall.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_5_last_man_trigger_core_end"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y));-1"
	}
}

; Fix the helicopter path due to the added skybox.
modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "stage_x_end_helicopter_track_7"
	}
	replace:
	{
		"origin" "-5952 -9235 5256"
	}
}

; Make zombies unable to survive and delay until zombies are slayed on stage 3.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_nuke_inmuzer1"
		"origin" "2496 -13032 1848"
	}
	insert:
	{
		"filtername" "team_filter_humans"
	}
}

; Move stage 2 "Tank" item to the version "6_1" one.
modify:
{
	match:
	{
		"classname" "env_entity_maker"
		"targetname" "Zombie_Item_Tank_Spawner"
	}
	replace:
	{
		"origin" "4848 -10200 -7248"
	}
}

; Add a fade in stage 3 cutscene.
add:
{
	"classname" "env_fade"
	"targetname" "stage_3_fade1"
	"rendercolor" "0 0 0"
	"renderamt" "255"
	"holdtime" ".75"
	"duration" ".5"
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_3_button"
	}
	insert:
	{
		"OnPressed" "stage_3_fade1,Fade,,5,1"
	}
}

modify:
{
	match:
	{
		"classname" "point_viewcontrol_multiplayer"
		"targetname" "stage_cinematic_cam"
	}
	insert:
	{
		"OnUser1" "stage_3_fade1,Kill,,19,-1"
		"OnUser1" "stage_3_fade1,Fade,,19,-1"
	}
}

; Change the "rendermode" to let us do the special effect thing.
modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "stage_5_pendulum_model"
	}
	replace:
	{
		"renderamt" "254"
	}	
	insert:
	{
		"rendermode" "2"
		"renderfx" "14"
	}
}

; Special effects.
add:
{
	"classname" "env_sprite"
	"targetname" "stage_3_stuff1"
	"origin" "2494 -10305 1520"
	"spawnflags" "1"
	"model" "sprites/glow04.vmt"
	"scale" "30"
	"rendermode" "7"
	"renderamt" "140"
	"GlowProxySize" "10"
	"HDRColorScale" "1"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_5_stuff1"
	"origin" "-8704 -980 -5248"
	"spawnflags" "1"
	"model" "sprites/halo.vmt"
	"scale" "40"
	"renderamt" "140"
	"rendermode" "7"
	"GlowProxySize" "10"
	"HDRColorScale" "1"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_5_stuff1"
	"origin" "-8744 -13854 -14160"
	"spawnflags" "1"
	"model" "sprites/glow.vmt"
	"scale" "40"
	"rendermode" "7"
	"renderamt" "140"
	"HDRColorScale" "1"
	"GlowProxySize" "10"
}

; Light sprites.
add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "4894 1092 -6834"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "4126 1092 -6834"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "7686 4356 -7058"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "6406 4356 -7058"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "5126 4356 -7058"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "3846 4356 -7058"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "2566 4356 -7058"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "1286 4356 -7058"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "6 4356 -7058"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_2_stuff1"
	"origin" "-1274 4356 -7058"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-9130 -8716 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-9818 -8716 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-8586 -8700 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-8058 -8700 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-7514 -8700 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-7514 -11132 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-8058 -11132 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-8586 -11132 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-9130 -11148 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add:
{
	"classname" "env_sprite"
	"targetname" "stage_4_stuff1"
	"origin" "-9818 -11148 3959"
	"spawnflags" "1"
	"model" "sprites/glow_test02.vmt"
	"scale" "2"
	"rendermode" "9"
	"renderfx" "14"
	"rendercolor" "216 205 180"
	"renderamt" "200"
	"HDRColorScale" ".5"
	"GlowProxySize" "10"
}

add: 
{
	"classname" "env_lightglow"
	"targetname" "stage_3_stuff1"
	"origin" "2494 -10305 1520"
	"HorizontalGlowSize" "210"
	"MaxDist" "10000"
	"OuterMaxDist" "11000"
	"VerticalGlowSize" "180"
	"GlowProxySize" "64"
	"HDRColorScale" "4"
}

add: 
{
	"classname" "env_lightglow"
	"targetname" "stage_5_stuff1"
	"origin" "4609 -4610 12743"
	"HorizontalGlowSize" "210"
	"MinDist" "100"
	"MaxDist" "7500"
	"OuterMaxDist" "1200"
	"rendercolor" "130 192 255"
	"VerticalGlowSize" "180"
	"GlowProxySize" "32"
	"HDRColorScale" "2"
}

add: 
{
	"classname" "env_lightglow"
	"targetname" "stage_5_stuff1"
	"origin" "-8704 -980 -4848"
	"HorizontalGlowSize" "210"
	"MaxDist" "11000"
	"OuterMaxDist" "1200"
	"rendercolor" "130 192 255"
	"VerticalGlowSize" "180"
	"GlowProxySize" "32"
	"HDRColorScale" "2"
}

add: 
{
	"classname" "env_lightglow"
	"targetname" "stage_5_stuff1"
	"origin" "-8744 -13854 -14160"
	"HorizontalGlowSize" "210"
	"MaxDist" "27000"
	"OuterMaxDist" "28000"
	"VerticalGlowSize" "180"
	"GlowProxySize" "64"
	"HDRColorScale" "4"
}

add: 
{
	"classname" "env_lightglow"
	"targetname" "stage_5_stuff1"
	"origin" "-8750 -12393 -13824"
	"HorizontalGlowSize" "210"
	"MaxDist" "27000"
	"OuterMaxDist" "28000"
	"VerticalGlowSize" "180"
	"GlowProxySize" "64"
	"HDRColorScale" "4"
}

; - - - - - - - - - - - - - - - - - - - - - - -
; Changes done by "Berke".
; - - - - - - - - - - - - - - - - - - - - - - -

; Fix spawn trigger not resetting players and make it teleport faster.
filter:
{
	"classname" "trigger_teleport"
	"targetname" "teleporter_main_trigger_positioner"
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "teleporter_main_trigger_positioner"
	}
	replace:
	{
		"origin" "-3488 9376 -8528"
		"wait" "1e30"
	}
	delete:
	{
		"model" "*273"
		"filtername" "Z_Items_Filter_Name"
		"OnStartTouch" "!activatorAddOutputtargetname 0-1"
		"OnStartTouch" "!activatorAddOutputgravity 10-1"
		"OnStartTouch" "!activatorAddOutputOnUser2 filter_player_killer:TestActivator::5:10-1"
		"OnStartTouch" "!activatorAddOutputOnUser3 !self:AddOutput:health 1200:0:10-1"
		"OnStartTouch" "!activatorAddOutputrendermode 00-1"
		"OnStartTouch" "!activatorAddOutputgravity 10-1"
		"OnUser1" "!activatorAddOutputOnUser3 !self:AddOutput:health 10000:0.1:10-1"
		"OnStartTouch" "!activatorAddOutputrenderfx 00-1"
		"OnStartTouch" "stage_end_explosion_workingTrigger5401"
		"OnStartTouch" "!activatorSetDamageFilter0-1"
		"OnStartTouch" "!activatorClearContext0-1"
		"OnStartTouch" "Global_Speed_suppressModifySpeed10-1"
	}
	insert:
	{
		"OnStartTouch" "Z_Items_Filter_Name,TestActivator,,,-1"
		"OnStartTouch" "stage_end_explosion_working,Trigger,,540,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "/teleporter_main_counter_case_[1-4]/"
	}
	insert:
	{
		"OnCase01" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase02" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase03" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase04" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase05" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase06" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase07" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase08" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase09" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase10" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase11" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase12" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase13" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase14" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase15" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
		"OnCase16" "stages_teleport_destination,TeleportToCurrentPos,,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "math_counter"
		"targetname" "teleporter_main_counter"
	}
	replace:
	{
		"startvalue" "0"
		"min" "0"
	}
	insert:
	{
		"OnHitMax" "!self,SetValue,0,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "info_teleport_destination"
		"targetname" "stages_teleport_destination"
	}
	replace:
	{
		"classname" "point_teleport"
	}
	insert:
	{
		"target" "!activator"
	}
}

modify:
{
	match:
	{
		"classname" "filter_activator_name"
		"targetname" "Z_Items_Filter_Name"
	}
	insert:
	{
		"OnPass" "!activator,AddOutput,targetname ,,-1"
		"OnPass" "!activator,AddOutput,gravity 1,,-1"
		"OnPass" "!activator,AddOutput,OnUser3 !self:AddOutput:health 1200::1,.01,-1"
		"OnPass" "!activator,AddOutput,rendermode 0,,-1"
		"OnPass" "!activator,AddOutput,renderfx 0,,-1"
		"OnPass" "!activator,AddOutput,renderamt 255,,-1"
		"OnPass" "!activator,SetDamageFilter,,,-1"
		"OnPass" "!activator,ClearContext,,,-1"
		"OnPass" "Global_Speed_suppress,ModifySpeed,1,,-1"
		"OnUser1" "!activator,AddOutput,OnUser3 !self:AddOutput:health 10000::1,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "/Extreme_Stage_[1-4]/"
	}
	delete:
	{
		"OnTrigger" "teleporter_main_trigger_positionerAddOutputOnStartTouch !self:FireUser1::0:00-1"
	}
	insert:
	{
		"OnTrigger" "Z_Items_Filter_Name,AddOutput,OnPass !self:FireUser1:::-1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "math_counter"
		"targetname" "Level_Counter"
	}
	insert:
	{
		"OnGetValue" "teleporter_main_trigger_positioner,AddOutput,solid 2,4,1"
		"OnGetValue" "teleporter_main_trigger_positionerRunScriptCodeself.SetSize(Vector(-2336, -224, -48), Vector(2336, 224, 48));41"
	}
}

modify:
{
	match:
	{
		"classname" "func_movelinear"
		"targetname" "teleporter_main_movelinear"
	}
	replace:
	{
		"spawnflags" "8"
		"movedir" "-90 0 0"
		"speed" "1500"
		"movedistance" "288"
	}
	insert:
	{
		"effects" "32"
	}
}

; Remove the message related to checkpoints in warmup round since this version doesn't have them.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Stage_Start_Stage_Warmup"
	}
	delete:
	{
		"OnTrigger" "Global_GameText_AnnouncementAddOutputmessage CHECKPOINT REACHED MEANS STAGE WONT REPEAT WHEN IT ENDS5-1"
	}
}

; Add props to get out of a stuck spot near "Tank" vehicle spawn on extreme stage 1.
add:
{
	"classname" "prop_dynamic"
	"targetname" "stage_1_stuff1"
	"origin" "2368 320 -13680"
	"angles" "0 -15 0"
	"model" "models/props/props_crates/wooden_crate_64x64.mdl"
	"solid" "6"
	"disableshadows" "1"
}

add:
{
	"classname" "prop_dynamic"
	"targetname" "stage_1_stuff1"
	"origin" "2368 320 -13608"
	"model" "models/props/props_crates/wooden_crate_64x64.mdl"
	"solid" "6"
	"disableshadows" "1"
}

add:
{
	"classname" "prop_dynamic"
	"targetname" "stage_1_stuff1"
	"origin" "2384 224 -13680"
	"angles" "-10 0 0"
	"model" "models/props/de_nuke/crate_large.mdl"
	"solid" "6"
	"disableshadows" "1"
}

; Add viewcontrol template related outputs, filter stage 1 "Juggernaut" trigger to humans, reset targetnames and prevent viewmodel from being glitched out.
filter:
{
	"classname" "logic_auto"
	"origin" "-2984 13152 -8552"
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Auto"
	}
	replace:
	{
		"spawnflags" "1"
	}
	delete:
	{
		"targetname" "Auto"
		"OnSpawn" "playerAddOutputtargetname nodriver0.05-1"
	}
	insert:
	{
		"OnSpawn" "worldspawn_brush,FireUser1,,,1"
		"OnSpawn" "Stages_Start_Fade,Fade,,,1"
		"OnSpawn" "Human_Item_Mech_RightArm,SetParentAttachment,RightArm,,1"
		"OnSpawn" "Human_Item_Mech_Left_Arm,SetParentAttachment,LeftArm,,1"
		"OnSpawn" "console,FireUser1,,,1"
		"OnSpawn" "stage_x_saw_rotating,FireUser1,,,1"
		"OnSpawn" "correction2,Disable,,,1"
		"OnSpawn" "correction,Disable,,,1"
		"OnSpawn" "Tonemap,FireUser1,,,-1"
		"OnSpawn" "consolaCliall,FireUser1,,,1"
		"OnSpawn" "Sun,FireUser1,,,1"
		"OnSpawn" "console,Command,zr_infect_mzombie_ratio 6,,1"
		"OnSpawn" "worldspawn_brush_target,FireUser2,,,1"
		"OnSpawn" "stage_x_crane_breakableRunScriptCodefunction InputUse() { return activator.GetTeam() == 3; }1"
		"OnSpawn" "stage_x_crane_crateRunScriptCodefunction InputUse() { return activator.GetTeam() == 3; }1"
		"OnSpawn" "player,AddOutput,targetname ,,1"
		"OnSpawn" "playerRunScriptCodeif (self.GetName() == _.zombie_boss || self.GetName() == _.human_mech) EntFireByHandle(Entities.FindByName(null, _.game_playerdie), _.FireUser1, __, -1, self, null);1"
		"OnSpawn" "map1manager1,CallScriptFunction,RoundSpawn,,1"
		"OnSpawn" "map1viewcontrolpreservedtemplate1,ForceSpawn,,.01,1"
		"OnSpawn" "map1viewcontroltemplate1,Kill,,.01,1"
		"OnSpawn" "Level_Counter,GetValue,,.02,1"
		"OnSpawn" "stage_flame_particle,Start,,2,1"
		"OnSpawn" "Mode_Extreme_Compare,FireUser1,,3,1"
		"OnSpawn" "console,Command,say ++ MAP BY HANNIBAL[SPA] / Rafuron ++,3,1"
		"OnSpawn" "Mode_Extreme_Counter,Add,1,3.1,1"
		"OnSpawn" "console,Command,say ++ MAP BY HANNIBAL[SPA] / Rafuron ++,4,1"
		"OnSpawn" "console,Command,say ++ MAP BY HANNIBAL[SPA] / Rafuron ++,5,1"
		"OnSpawn" "console,Command,say ++ MAP FIXED BY STRUPPI ++,7,1"
		"OnSpawn" "console,Command,say ++ Thanks to George and Sgt. zuff ++,8,1"
		"OnSpawn" "console,Command,say ++ Type ''!showmapstats'' to see the events you completed and damage dealt to zombies on stage 5. ++,9,1"
		"OnSpawn" "console,Command,say ++ They increase your chance to be chosen for the solo ending. ++,10,1"
		"OnSpawn" "v_button1,Unlock,,10,1"
		"OnSpawn" "teleporter_main_trigger_positioner,AddOutput,OnStartTouch stages_teleport_destination:TeleportToCurrentPos:::-1,20,1"
		"OnSpawn" "teleporter_main_counter*,Kill,,20,1"
	}
}

; Reduce stage 2 car generator movelinear speed slightly to prevent console error.
modify:
{
	match:
	{
		"classname" "func_movelinear"
		"targetname" "Spawn_Phy_Car_Generator_Movelinear"
	}
	replace:
	{
		"speed" "1900"
	}
}

; Fix stage 2 last vent entrance being breakable early.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_2_teleport_2"
	}
	insert:
	{
		"OnStartTouch" "stage_2_escape_vent,SetHealth,100,10,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_breakable"
		"targetname" "stage_2_escape_vent"
	}
	replace:
	{
		"health" "0"
	}
}

; Optional: Prevent "Portal Gun" item skips.
;modify:
;{
;	match:
;	{
;		"classname" "func_button"
;		"targetname" "Weapon_PortalGun_UI"
;	}
;	replace:
;	{
;		"origin" "-1004 13248 -8512"
;	}
;}

;modify:
;{
;	match:
;	{
;		"classname" "env_entity_maker"
;		"targetname" "Weapon_PortalGun_Projectile_Spawner"
;	}
;	replace:
;	{
;		"origin" "-1088 13248 -8520"
;	}
;}

; Fix stage 2 last vent fall breaking despite second room being "Mutator Test" and fix pressing the buttons when room isn't selected.
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "stage_2_open_random_relay"
	}
	insert:
	{
		"OnCase01" "stage_2_main_room_second_button_next,Unlock,,,1"
		"OnCase01" "stage_2_main_room_second_button_nextRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnCase01" "stage_2_main_room_button_next,Kill,,,1"
		"OnCase03" "stage_2_main_room_button_next,Unlock,,,1"
		"OnCase03" "stage_2_main_room_button_nextRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnCase03" "stage_2_main_room_second_button_next,Kill,,,1"
		"OnCase03" "stage_2_end_trigger,AddOutput,OnTrigger stage_2_vent_breakable:Break:::1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_2_main_room_button_next"
	}
	replace:
	{
		"spawnflags" "19457"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_2_main_room_button_next"
		"origin" "5462 1048 -6892"
	}
	delete:
	{
		"OnPressed" "stage_2_open_random_logicTrigger0-1"
	}
	replace:
	{
		"targetname" "stage_2_main_room_second_button_next"
	}
}

; Fix possibility of this trigger firing outputs more than once.
modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_2_end_trigger"
	}
	delete:
	{
		"OnStartTouch" "stage_2_vent_breakableBreak0-1"
		"OnStartTouch" "stage2_afk_teleportEnable0-1"
		"OnStartTouch" "stage2_afk_teleportDisable1-1"
		"OnStartTouch" "Spawn_Phy_Car_Hurt*Kill0-1"
		"OnStartTouch" "Spawn_Phy_Car_2_Hurt*Kill0-1"
		"OnStartTouch" "stage_x_second_doorClose0-1"
		"OnStartTouch" "stage_2_end_pushKill0-1"
	}
	insert:
	{
		"OnTrigger" "stage2_afk_teleport,Enable,,,1"
		"OnTrigger" "stage2_afk_teleport,Disable,,1,1"
		"OnTrigger" "Spawn_Phy_Car_Hurt*,Kill,,,1"
		"OnTrigger" "Spawn_Phy_Car_2_Hurt*,Kill,,,1"
		"OnTrigger" "stage_x_second_door,Close,,,1"
		"OnTrigger" "stage_2_end_push,Kill,,,1"
	}
}

; Reduce volume of "Mech" item "Minigun" sound.
modify:
{
	match:
	{
		"classname" "ambient_generic"
		"targetname" "Human_Item_Mech_Sound_Minigun"
	}
	replace:
	{
		"health" "3"
	}
}

; Fix stage 4 nuke pit teleport being setup wrong.
modify:
{
	match:
	{
		"classname" "trigger_teleport"
		"targetname" "stage_4_trigger_pad"
	}
	delete:
	{
		"landmark" "stages_teleport_destination"
	}
	insert:
	{
		"target" "stages_teleport_destination"
	}
}

; Fix stage 4 nuke pad being broken showing the wrong message and being able to be damaged multiple times, uses "OnUser1" because we don't want it to be damaged early.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_4_end_button_protection"
	}
	replace:
	{
		"spawnflags" "3073"
		"wait" "-1"
	}
	delete:
	{
		"OnDamaged" "stage_4_nuke_worksDisable0-1"
		"OnDamaged" "Global_GameText_AnnouncementRunScriptCodesetMessage(3)0-1"
		"OnDamaged" "stage_4_end_nuke_malfunctionStartSpark0-1"
		"OnDamaged" "Global_Message_Top_RightDisplay0.05-1"
		"OnDamaged" "Global_Message_Top_RightAddOutputholdtime 00-1"
		"OnDamaged" "Global_Message_Top_CountdownKill0-1"
		"OnDamaged" "Global_GameText_AnnouncementFireUser30-1"
	}
	insert:
	{
		"OnUser1" "!self,Kill,,,1"
		"OnUser1" "stage_4_nuke_works,Disable,,,1"
		"OnUser1" "stage_4_end_nuke_malfunction,StartSpark,,,1"
		"OnUser1" "Global_Message_Top_Right,Display,,,1"
		"OnUser1" "Global_Message_Top_Right,SetText,,,1"
		"OnUser1" "Global_Message_Top_Right,AddOutput,holdtime 0,,1"
		"OnUser1" "Global_Message_Top_Countdown,Kill,,,1"
		"OnUser1" "Global_GameText_Announcement,FireUser3,,,1"
		"OnUser1" "Global_GameText_AnnouncementRunScriptCodesetMessage(33);1"
	}
}

; Fix the new truck model used in stage 5 not covering the side like in the original.
modify:
{
	match:
	{
		"classname" "prop_dynamic_override"
		"targetname" "stage_5_megatrontruck"
	}
	replace:
	{
		"origin" "3904 -3440 12480"
	}
}

; Prevent explosions from triggering repeat killer.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Spawn_Explosion_Logic"
	}
	insert:
	{
		"OnSpawn" "Spawn_Explosion_Damage,AddOutput,classname norepeatkiller1,,1"
		"OnSpawn" "Spawn_Explosion_Damage_All,AddOutput,classname norepeatkiller1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Spawn_Explosion_Small_Logic"
	}
	insert:
	{
		"OnSpawn" "Spawn_Explosion_Small_Damage,AddOutput,classname norepeatkiller1,,1"
		"OnSpawn" "Spawn_Explosion_Small_Damage_H,AddOutput,classname norepeatkiller1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Spawn_Nuke_Trigger"
	}
	insert:
	{
		"OnSpawn" "Spawn_Nuke_Hurt,AddOutput,classname norepeatkiller1,,1"
	}
}

; When a "Tank" vehicle controlled by a zombie is killed, don't make it disappear but make it non-solid and darken it.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "_human_item_tank_health_drivver_zombiekill"
	}
	replace:
	{
		"spawnflags" "1"
	}
	delete:
	{
		"OnTrigger" "v_model1Break0-1"
	}
	insert:
	{
		"OnTrigger" "v_model1,AddOutput,solid 0,,1"
		"OnTrigger" "v_button1,Kill,,,1"
		"OnTrigger" "v_model1,Color,64 64 64,.01,1"
		"OnTrigger" "Tank_Cannon,Color,64 64 64,.01,1"
	}
}

; Prevent camping zombie spawns and add filters that prevent all damage but nuke.
add:
{
	"classname" "filter_activator_name"
	"targetname" "map1nukefilter1"
	"filtername" "Nuke_Kill_Trigger"
}

add:
{
	"classname" "filter_activator_name"
	"targetname" "map1nukefilter2"
	"filtername" "Kill_All_Trigger"
}

add:
{
	"classname" "filter_activator_name"
	"targetname" "map1nukefilter3"
	"filtername" "stage_3_nuke"
}

add:
{
	"classname" "filter_multi"
	"targetname" "map1mainnukefilter1"
	"FilterType" "1"
	"Filter01" "map1nukefilter1"
	"Filter02" "map1nukefilter2"
	"Filter03" "map1nukefilter3"
}

; Stage 1
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_1_stuff1"
	"origin" "1672 -464 -13632"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_1_stuff1"
	"origin" "6392 224 -13632"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_1_stuff1"
	"origin" "12184 -10384 -13632"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_1_stuff1"
	"origin" "3856 -9368 -12848"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

; Stage 2
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_2_stuff1"
	"origin" "3920 768 -7376"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_2_stuff1"
	"origin" "-1048 3656 -7632"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_2_stuff1"
	"origin" "-1296 6048 -8032"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

; Stage 3
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_3_stuff1"
	"origin" "-296 6392 -560"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_3_stuff1"
	"origin" "6640 5224 832"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_3_stuff1"
	"origin" "8000 3880 1216"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

; Stage 4
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_4_stuff1"
	"origin" "5968 7952 3376"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_4_stuff1"
	"origin" "176 -800 3376"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_4_stuff1"
	"origin" "-11072 -10488 3376"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_4_stuff1"
	"origin" "9608 -7704 3376"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

; Implement the unused zombie teleport in extreme stage 1 and also make it not go too further when opening.
modify:
{
	match:
	{
		"classname" "func_movelinear"
		"targetname" "stage_x_camp_door"
	}
	replace:
	{
		"movedistance" "256"
	}
	insert:
	{
		"OnFullyOpen" "stage_positioner_teleport,InValue,11,,1"
	}
}

; Implement the unused zombie teleport in extreme stage 3.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_3_tests_relay_1"
	}
	insert:
	{
		"OnTrigger" "stage_positioner_teleport,InValue,32,,1"
	}
}

; Fix viewcontrols being laggy for "Boss" and "Mech" items.
; Delete the old system used for viewcontrols.
filter:
{
	"classname" "logic_measure_movement"
	"targetname" "Zombie_Item_Boss_Measure"
}

filter:
{
	"classname" "info_teleport_destination"
	"targetname" "Zombie_Item_Boss_Cam_Pos_2"
}

filter:
{
	"classname" "logic_measure_movement"
	"targetname" "Human_Item_Mech_Measure"
}

filter:
{
	"classname" "info_teleport_destination"
	"targetname" "Human_Item_Mech_Cam_Pos_2"
}

; Add the new system where we spawn the viewcontrols using a preserved template and spawn them parented.
modify:
{
	match:
	{
		"classname" "point_viewcontrol"
		"targetname" "Zombie_Item_Boss_Cam"
	}
	insert:
	{
		"parentname" "Zombie_Item_Boss_Cam_Pos"
	}
}

modify:
{
	match:
	{
		"classname" "point_viewcontrol"
		"targetname" "Human_Item_Mech_Cam"
	}
	insert:
	{
		"parentname" "Human_Item_Mech_Knife"
	}
}

add:
{
	"classname" "point_template"
	"targetname" "map1viewcontroltemplate1"
	"Template01" "Zombie_Item_Boss_Cam"
	"Template02" "Human_Item_Mech_Cam"
}

modify:
{
	match:
	{
		"classname" "info_target"
		"targetname" "worldspawn_brush_target"
	}
	insert:
	{
		"OnUser2" "map1viewcontrolpreservedtemplate1,AddOutput,classname info_ladder,,1"
		"OnUser2" "map1viewcontroltemplate1,AddOutput,targetname map1viewcontrolpreservedtemplate1,,1"
	}
}

; When someone dies, give them empty targetname instead of one called "none" and prevent viewmodel from being glitched out.
modify:
{
	match:
	{
		"classname" "trigger_brush"
		"targetname" "game_playerdie"
	}
	delete:
	{
		"OnUse" "!activatorAddOutputtargetname none0-1"
	}
	insert:
	{
		"DontMessageParent" "1"
		"OnUse" "!activator,AddOutput,targetname ,,-1"
		"OnUse" "!activatorRunScriptCodeif (self.GetName() == _.zombie_boss || self.GetName() == _.human_mech) EntFireByHandle(caller, _.FireUser1, __, -1, self, null);-1"
		"OnUser1" "Map_End_Camera,RemovePlayer,,,2"
		"OnUser1" "Map_End_Camera,AddPlayer,,,2"
	}
}

; Make trigger of extreme stage 3 third test room bigger to prevent zombies avoiding it by staying just next to the room.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_3_tests_main_5"
	}
	replace:
	{
		"model" "*279"
		"origin" "5025.78 5771.83 968"
	}
}

; Implement a better zombie trigger system.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Extreme_Stage_1"
	}
	insert:
	{
		"OnTrigger" "stage_1_extratrigger1,Kill,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_1_button_tower_top"
	}
	delete:
	{
		"OnPressed" "bullshitadderKill01"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "ZOMBIESTRIGGERED"
	}
	replace:
	{
		"spawnflags" "1"
	}
	delete:
	{
		"vscripts" "hichatu/zm_trigger.nut"
		"OnTrigger" "Kill_All_TriggerEnable21"
	}
	insert:
	{
		"OnTrigger" "map1roundend1,EndRound_TerroristsWin,7,,1"
	}
}

add:
{
	"classname" "game_round_end"
	"targetname" "map1roundend1"
	"OnRoundEnded" "map1roundend1,Kill,,,1"
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "bullshitadder"
	}
	replace:
	{
		"targetname" "stage_1_extratrigger1"
	}
	delete:
	{
		"OnStartTouch" "stage_1_button_end_2AddOutputOnPressed ZOMBIESTRIGGERED:RunScriptCode:progressTrigger():0:101"
	}
	insert:
	{
		"OnTrigger" "stage_1_button_end_2RunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnTrigger" "stage_1_button_end_2,AddOutput,OnPressed !self:Kill:::1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"OnPressed" "ZOMBIESTRIGGEREDRunScriptCodeprogressTrigger()01"
	}
	replace:
	{
		"wait" "-1"
		"rendermode" "10"
	}
	delete:
	{
		"OnPressed" "ZOMBIESTRIGGEREDRunScriptCodeprogressTrigger()01"
	}
	insert:
	{
		"OnPressed" "!self,Kill,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage1_things"
	}
	insert:
	{
		"OnEntitySpawned" "stage_1_button_tower_topRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_1_road_button_alternative_pathRunScriptCodefunction InputUse() { if (activator) { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; } }1"
		"OnEntitySpawned" "stage_1_bridge_buttonRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_1_button_endRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
	}
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage1_x_things"
	}
	insert:
	{
		"OnEntitySpawned" "stage_x_btn_endRunScriptCodefunction InputUse() { return activator.GetTeam() == 3; }1"
	}
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage2_things"
	}
	insert:
	{
		"OnEntitySpawned" "stage_2_entrance_buttonRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_2_btn_mainRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_2_button_weapon_doorRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_2_minifier_buttonRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_2_button_core_generatorRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
	}
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage3_things"
	}
	insert:
	{
		"OnEntitySpawned" "stage_3_spawnRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_3_corridor_button_*RunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_3_button_lock*RunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_3_button_core_*RunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
		"OnEntitySpawned" "stage_3_core_buttonRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Extreme_Stage_3"
	}
	insert:
	{
		"OnTrigger" "stage_3_weapons_button_2RunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }21"
		"OnTrigger" "stage_3_weapons_button_3*RunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }21"
	}
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage4_things"
	}
	insert:
	{
		"OnEntitySpawned" "stage_4_custombrush1,AddOutput,solid 2,,1"
		"OnEntitySpawned" "stage_4_custombrush1RunScriptCodeself.SetSize(Vector(-256, -448, -1696), Vector(256, 448, 1696));1"
		"OnEntitySpawned" "stage_4_teleport,AddOutput,solid 2,,1"
		"OnEntitySpawned" "stage_4_teleportRunScriptCodeself.SetSize(Vector(-4700, -11.5, -1856), Vector(4700, 11.5, 1856));1"
		"OnEntitySpawned" "stage_4_end_button*RunScriptCodefunction InputUse() { return activator.GetTeam() == 3; }1"
	}
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage4_x_things"
	}
	insert:
	{
		"OnEntitySpawned" "stage_x_part_4_explosion_buttonRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2 && activator.GetName() != _.zombie_freezer) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
	}
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage5_things"
	}
	insert:
	{
		"OnEntitySpawned" "stage_5_hurt,AddOutput,classname norepeatkiller1,,1"
	}
}

; Make "Ultralisk" come faster on event he's not killed.
modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "stage5_things"
	}
	insert:
	{
		"OnEntitySpawned" "stage_5_lower_door_button_LIFTRunScriptCodefunction InputUse() { return activator.GetTeam() == 3; }1"
	}
}

; Prevent pressing trigger buttons when triggered.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_1_button_elevator"
	}
	insert:
	{
		"OnPressed" "!self,AddOutput,spawnflags 1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_breakable"
		"targetname" "stage_x_end_elevator_1_doors"
	}
	insert:
	{
		"OnBreak" "stage_1_button_elevatorRunScriptCodefunction InputUse() { return activator.GetTeam() == 3; }51"
		"OnBreak" "stage_1_button_elevatorRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }201"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_x_part_4_explosion_button"
	}
	insert:
	{
		"OnPressed" "!selfRunScriptCodedelete InputUse;1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "/stage_(1_(button_(tower_top|end)|road_button_alternative_path)|2_((entrance|minifier)_button|main_room_button_next|button_(factory_control|core_factory)))/"
	}
	replace:
	{
		"wait" "-1"
		"rendermode" "10"
	}
	insert:
	{
		"OnPressed" "!self,Kill,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "/stage_(3_(spawn|corridor_button_(1|3(x|)|4|8)|weapons_button_(2|3(x|))|tests_door_button_8|core_button|button(_(2|(lock(_[2-6]|)|core_(left|right)))|))|4_part_(3_button|5_button_(2|[7-9]|10)))/"
	}
	replace:
	{
		"wait" "-1"
		"rendermode" "10"
	}
	insert:
	{
		"OnPressed" "!self,Kill,,,1"
	}
}

; Kill entities when used.
modify:
{
	match:
	{
		"classname" "math_counter"
		"targetname" "/stage_(3_cor(ridor_door_[4-5]_unlock|e_counter)|5_lower_counter_energy)/"
	}
	insert:
	{
		"OnHitMax" "!self,Kill,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "stage_3_core_counter_elevator"
	}
	insert:
	{
		"OnEqualTo" "!self,Kill,,,1"
	}
}

; No need for filters anymore.
filter:
{
	"classname" "filter_activator_team"
	"targetname" "stage_3_core_button_filter"
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_3_core_button"
	}
	delete:
	{
		"OnPressed" "stage_3_core_button_filterTestActivator0-1"
	}
	insert:
	{
		"OnPressed" "stage_target_helper_3,SetLocalOrigin,0 0 0,,1"
		"OnPressed" "Global_GameText_Objective,FireUser2,,,1"
		"OnPressed" "stage_3_tests_door_button_7,FireUser1,,,1"
		"OnPressed" "stage_3_core_counter,Add,1,,1"
		"OnPressed" "Global_Give_30_points,ApplyScore,,,1"
	}
}

filter:
{
	"classname" "filter_activator_team"
	"targetname" "stage_4_end_button_filter"
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_4_end_button"
	}
	replace:
	{
		"spawnflags" "3073"
	}
	delete:
	{
		"OnPressed" "stage_4_end_button_filterTestActivator0-1"
	}
	insert:
	{
		"OnPressed" "stage_x_end_nuke_door_*,Open,,,1"
		"OnPressed" "stage_x_nuke_train,Open,,,1"
		"OnPressed" "Glocal_Message_Selector,InValue,stage4_end,,1"
		"OnPressed" "stage_4_nuke_works,Trigger,,80,1"
		"OnPressed" "stage_x_end_bridge_1,Open,,43,1"
		"OnPressed" "Global_GameText_Announcement,FireUser4,,,1"
		"OnPressed" "Global_GameText_AnnouncementRunScriptCodesetMessage(3);1"
		"OnPressed" "Global_GameText_Objective,FireUser2,,,1"
		"OnPressed" "stage_target_helper_2,SetLocalOrigin,0 0 0,,1"
		"OnPressed" "stage_x_ultralistk_model,FireUser2,,60,1"
		"OnPressed" "stage_positioner_teleport,InValue,44,,1"
	}
}

filter:
{
	"classname" "filter_activator_team"
	"targetname" "stage_4_end_button_protection_filter"
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_4_end_button_protection"
	}
	replace:
	{
		"spawnflags" "3073"
	}
	delete:
	{
		"OnPressed" "stage_4_end_button_protection_filterTestActivator0-1"
	}
	insert:
	{
		"OnPressed" "stage_x_end_nuke_protection_door,Close,,,1"
		"OnPressed" "Global_GameText_Announcement,FireUser4,,,1"
		"OnPressed" "Global_GameText_AnnouncementRunScriptCodesetMessage(6);1"
		"OnPressed" "Global_Give_30_points,ApplyScore,,,1"
		"OnPressed" "fallback_fade,Fade,,,-1"
	}
}

filter:
{
	"classname" "filter_activator_team"
	"targetname" "stage_5_button_filter"
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_5_lower_door_button_LIFT"
	}
	replace:
	{
		"wait" "-1"
	}
	delete:
	{
		"OnPressed" "stage_5_button_filterTestActivator0-1"
	}
	insert:
	{
		"OnPressed" "stage_5_lower_timer*,Kill,,,1"
		"OnPressed" "stage_5_lower_door_case,Kill,,,1"
		"OnPressed" "stage_5_to_top_teleport,FireUser1,,15,1"
		"OnPressed" "stage_x_main_lift,Open,,5,1"
		"OnPressed" "stage_0_alarm_sound_emergency,StopSound,,,1"
		"OnPressed" "stage_target_helper,SetLocalOrigin,4616 2120 12248,,1"
		"OnPressed" "Global_GameText_Objective,FireUser3,,,1"
		"OnPressed" "Global_GameText_Announcement,FireUser4,,,1"
		"OnPressed" "Global_GameText_Announcement,SetText,** LIFT TO TOP IN 5 SECONDS **,,1"
		"OnPressed" "stage_x_lower_bridges_tracktrain*,Close,,,1"
		"OnPressed" "stage_5_end_hint,SetText,,,1"
		"OnPressed" "stage_0_alarm_sound_emergency,StopSound,,,1"
		"OnPressed" "stage_5_tank_kill,Enable,,5,1"
	}
}

; Kill stage relays when triggered.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "/Stage_Start_Stage_5|Extreme_Stage_([0-5]|common)/"
	}
	replace:
	{
		"spawnflags" "1"
	}
}

; Fix warmup texts.
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Stage_Warmup_Random_Messages_Case"
	}
	delete:
	{
		"OnCase01" "Global_GameText_Stage_StartRunScriptCodesetMessage(35)0-1"
		"OnCase02" "Global_GameText_Stage_StartRunScriptCodesetMessage(36)0-1"
		"OnCase03" "Global_GameText_Stage_StartRunScriptCodesetMessage(37)00"
		"OnCase04" "Global_GameText_Stage_StartRunScriptCodesetMessage(38)0-1"
		"OnCase05" "Global_GameText_Stage_StartRunScriptCodesetMessage(39)0-1"
		"OnCase06" "Global_GameText_Stage_StartRunScriptCodesetMessage(40)0-1"
		"OnCase07" "Global_GameText_Stage_StartRunScriptCodesetMessage(41)0-1"
		"OnCase08" "Global_GameText_Stage_StartRunScriptCodesetMessage(42)0-1"
		"OnCase09" "Global_GameText_Stage_StartRunScriptCodesetMessage(43)0-1"
		"OnCase10" "Global_GameText_Stage_StartRunScriptCodesetMessage(44)0-1"
		"OnCase11" "Global_GameText_Stage_StartRunScriptCodesetMessage(45)0-1"
		"OnCase12" "Global_GameText_Stage_StartRunScriptCodesetMessage(46)0-1"
		"OnCase13" "Global_GameText_Stage_StartRunScriptCodesetMessage(47)0-1"
		"OnCase14" "Global_GameText_Stage_StartRunScriptCodesetMessage(48)0-1"
		"OnCase15" "Global_GameText_Stage_StartRunScriptCodesetMessage(49)0-1"
	}
	insert:
	{
		"OnCase01" "Global_GameText_Stage_StartRunScriptCodesetMessage(34);1"
		"OnCase02" "Global_GameText_Stage_StartRunScriptCodesetMessage(35);1"
		"OnCase03" "Global_GameText_Stage_StartRunScriptCodesetMessage(36);1"
		"OnCase04" "Global_GameText_Stage_StartRunScriptCodesetMessage(37);1"
		"OnCase05" "Global_GameText_Stage_StartRunScriptCodesetMessage(38);1"
		"OnCase06" "Global_GameText_Stage_StartRunScriptCodesetMessage(39);1"
		"OnCase07" "Global_GameText_Stage_StartRunScriptCodesetMessage(40);1"
		"OnCase08" "Global_GameText_Stage_StartRunScriptCodesetMessage(41);1"
		"OnCase09" "Global_GameText_Stage_StartRunScriptCodesetMessage(42);1"
		"OnCase10" "Global_GameText_Stage_StartRunScriptCodesetMessage(43);1"
		"OnCase11" "Global_GameText_Stage_StartRunScriptCodesetMessage(44);1"
		"OnCase12" "Global_GameText_Stage_StartRunScriptCodesetMessage(45);1"
		"OnCase13" "Global_GameText_Stage_StartRunScriptCodesetMessage(46);1"
		"OnCase14" "Global_GameText_Stage_StartRunScriptCodesetMessage(47);1"
		"OnCase15" "Global_GameText_Stage_StartRunScriptCodesetMessage(48);1"
	}
}

; Remove missing animation inputs.
modify:
{
	match:
	{
		"classname" "func_tanktrain"
		"targetname" "Vehicle_Fake_Helicopter_TrackTrain"
	}
	delete:
	{
		"OnUser1" "Vehicle_Fake_Helicopter_ModelSetAnimationstart_fast_fly0-1"
		"OnUser1" "Vehicle_Fake_Helicopter_ModelSetDefaultAnimationfast_fly0-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_x_helicopter_can_leave"
	}
	delete:
	{
		"OnTrigger" "stage_x_helicopterSetAnimationidle0-1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_x_end_button_blue"
	}
	delete:
	{
		"OnUser1" "stage_x_core_column_button_modelSetAnimationclose0-1"
	}
}

modify:
{
	match:
	{
		"classname" "func_door"
		"targetname" "stage_x_core_column_mv_btns"
	}
	delete:
	{
		"OnFullyOpen" "stage_x_core_column_button_modelSetAnimationopen0-1"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "Weapons_Turret_Model_Deployed"
	}
	delete:
	{
		"OnAnimationDone" "Weapon_Turret_Deployed_DevBrushSetParentAttachmentMaintainOffsetturret0-1"
	}
}

; Remove missing sounds.
modify:
{
	match:
	{
		"noise1" "E3_C17_02.GateGrindsDown1"
	}
	delete:
	{
		"noise1" "E3_C17_02.GateGrindsDown1"
	}
}

modify:
{
	match:
	{
		"unlocked_sound" "7"
	}
	replace:
	{
		"unlocked_sound" "0"
	}
}

modify:
{
	match:
	{
		"soundopenoverride" "Doors.CombineGate_citizen_stop2"
	}
	delete:
	{
		"soundopenoverride" "Doors.CombineGate_citizen_stop2"
	}
}

modify:
{
	match:
	{
		"soundcloseoverride" "Doors.CombineGate_citizen_stop2"
	}
	delete:
	{
		"soundcloseoverride" "Doors.CombineGate_citizen_stop2"
	}
}

; Remove invalid keyvalue.
modify:
{
	match:
	{
		"Negated" "Allow entities that match criteria"
	}
	replace:
	{
		"Negated" "0"
	}
}

; Shorten some button delays.
modify:
{
	match:
	{
		"classname" "func_button"
		"wait" "0.1"
	}
	replace:
	{
		"wait" ".01"
	}
}

; Remove extra model.
filter:
{
	"classname" "prop_dynamic"
	"targetname" "Weapon_ZeroGravity_Model"
	"origin" "-1298.06 12522 -8552.82"
}

; Make stage 2 lobby door non-solid.
modify:
{
	match:
	{
		"classname" "func_door"
		"targetname" "stage_x_second_door"
	}
	replace:
	{
		"spawnflags" "808"
		"forceclosed" "1"
		"dmg" "9999"
	}
	insert:
	{
		"effects" "32"
	}
}

; Optional: Prevent the stage 2 lobby door killing humans.
;modify:
;{
;	match:
;	{
;		"classname" "func_door"
;		"targetname" "stage_x_second_door"
;	}
;	replace:
;	{
;		"dmg" "0"
;	}
;	insert:
;	{
;		"OnBlockedClosing" "!activatorRunScriptCodeif (self.GetTeam() == 3) self.SetOrigin(Vector(self.GetOrigin().x, 605, self.GetOrigin().z)); else EntFireByHandle(self, _.SetHealth, (0).tostring(), -1, null, null);-1"
;		"OnBlockedClosing" "!self,Open,,,-1"
;		"OnBlockedClosing" "!self,Close,,.01,-1"
;	}
;}

; Fix extreme stage 3 elevators being blockable.
modify:
{
	match:
	{
		"classname" "func_door"
		"targetname" "/stage_x_lift_[1-2]/"
	}
	replace:
	{
		"forceclosed" "1"
	}
}

; Prevent blocking bridge lowering in stage 4.
modify:
{
	match:
	{
		"classname" "func_door"
		"targetname" "stage_x_end_bridge_1"
	}
	replace:
	{
		"spawnflags" "512"
		"dmg" "9999"
	}
}

; Useless input on stage 3.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_3_button"
	}
	delete:
	{
		"OnPressed" "stage_target_helperAddOutput0 0 001"
	}
}

; Kill stage 4 train entities when no longer needed.
modify:
{
	match:
	{
		"classname" "func_tanktrain"
		"targetname" "Vehicle_Fake_Truck_Tracktrain1"
	}
	delete:
	{
		"OnUser2" "Vehicle_Fake_Truck_HurtDisable0-1"
		"OnUser2" "Vehicle_Fake_Truck_teleportDisable0-1"
		"OnUser2" "Vehicle_Fake_Truck_Tracktrain1_tankkillerDisable0-1"
	}
	insert:
	{
		"OnUser2" "Vehicle_Fake_Truck_Hurt,Kill,,,1"
		"OnUser2" "Vehicle_Fake_Truck_teleport,Kill,,,1"
		"OnUser2" "Vehicle_Fake_Truck_Tracktrain1_tankkiller,Kill,,,1"
	}
}

; Fix broken message on stage 4.
modify:
{
	match:
	{
		"classname" "func_tracktrain"
		"targetname" "stage_x_part_4_plane_tracktrain"
	}
	delete:
	{
		"OnUser1" "Global_GameText_AnnouncementRunScriptCodeRunScriptCode(19)01"
	}
	insert:
	{
		"OnUser1" "Global_GameText_Announcement,FireUser3,,,1"
		"OnUser1" "Global_GameText_AnnouncementRunScriptCodesetMessage(19);1"
	}
}

; Fix some funky stuff in stage 4 big gate.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_4_part_3_button"
	}
	insert:
	{
		"OnPressed" "fallback_fade,Fade,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "stage_4_door_phys"
	}
	replace:
	{
		"spawnflags" "15003648"
	}
	insert:
	{
		"OnBreak" "stage_4_part_3_button,Kill,,,1"
		"OnBreak" "stage_4_teleport,Kill,,,1"
	}
}

; Fix some camera stuff in warmup and stage 3.
filter:
{
	"classname" "trigger_multiple"
	"targetname" "stage_0_end_camera_disable"
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "stage_0_end_camera_disable"
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_0_trigger_detect_zombification"
	}
	delete:
	{
		"OnStartTouch" "!activatorAddOutputorigin 1592 3912 2110.20-1"
		"OnStartTouch" "Global_Weapon_StripStripWeaponsAndSuit0-1"
	}
	insert:
	{
		"OnTrigger" "!activator,SetLocalOrigin,1592 3912 2110,,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_0_zombie_boss_trigger"
	}
	insert:
	{
		"OnTrigger" "Global_Weapon_Strip,Strip,,,1"
		"OnTrigger" "stage_0_trigger_detect_zombification,Kill,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Supreme_Trigger"
	}
	delete:
	{
		"OnTrigger" "stage_0_end_cameraEnable12-1"
		"OnTrigger" "stage_0_end_cameraDisable13-1"
		"OnTrigger" "stage_0_end_camera_disableEnable41-1"
		"OnTrigger" "stage_0_end_camera_disableDisable42-1"
	}
	insert:
	{
		"OnTrigger" "Map_End_Camera,Enable,,12,1"
		"OnTrigger" "Map_End_Camera,Disable,,41,1"
	}
}

filter:
{
	"classname" "trigger_once"
	"targetname" "stage_3_camera"
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "stage_3_camera_deactivator"
}

filter:
{
	"classname" "filter_activator_team"
	"targetname" "Global_Team_Set_No_Damage_Z"
}

modify:
{
	match:
	{
		"classname" "point_viewcontrol_multiplayer"
		"targetname" "stage_cinematic_cam"
	}
	delete:
	{
		"OnUser1" "playerFireUser40.03-1"
		"OnUser1" "playerAddOutputOnUser4 stage_3_cinematic_cam:Enable::0:10.02-1"
		"OnUser1" "playerFireUser40.01-1"
		"OnUser1" "playerAddOutputOnUser4 Global_Team_Set_No_Damage_Z:TestActivator::0:10-1"
		"OnUser1" "playerSetDamageFilterteam_filter_humans0-1"
		"OnUser1" "stage_3_cameraEnable0-1"
		"OnUser1" "stage_3_camera_deactivatorEnable20-1"
		"OnUser1" "stage_3_camera_deactivatorDisable22-1"
		"OnUser1" "stage_3_cameraDisable1-1"
	}
	insert:
	{
		"OnUser1" "!self,Enable,,,-1"
		"OnUser1" "consolaCliall,FireUser4,,,-1"
		"OnUser1" "!self,Disable,,20,-1"
		"OnUser1" "consolaCliall,FireUser1,,20,-1"
	}
}

; Optional: Disable HUD during warmup cutscene.
;modify:
;{
;	match:
;	{
;		"classname" "logic_relay"
;		"targetname" "Supreme_Trigger"
;	}
;	insert:
;	{
;		"OnTrigger" "player,SetHUDVisibility,0,12,1"
;		"OnTrigger" "player,SetHUDVisibility,1,41,1"
;	}
;}

; Optional: Disable HUD during stage 3 cutscene.
;modify:
;{
;	match:
;	{
;		"classname" "point_viewcontrol_multiplayer"
;		"targetname" "stage_cinematic_cam"
;	}
;	insert:
;	{
;		"OnUser1" "player,SetHUDVisibility,0,,-1"
;		"OnUser1" "player,SetHUDVisibility,1,20,-1"
;	}
;}

; Optional: Kill the humans on stage 3 who weren't on boss room when it starts.
;modify:
;{
;	match:
;	{
;		"classname" "trigger_multiple"
;		"targetname" "stage_3_boss_teleport"
;	}
;	insert:
;	{
;		"OnStartTouch" "!activatorRunScriptCodeif (self.GetTeam() == 3) EntFireByHandle(self, _.SetHealth, (0).tostring(), -1, null, null);20-1"
;	}
;}

; Remove missing script.
modify:
{
	match:
	{
		"classname" "func_button"
		"vscripts" "filter.nut"
	}
	delete:
	{
		"vscripts" "filter.nut"
		"OnPressed" "!selfRunScriptCodeFilterHolder();0-1"
	}
}

; Remove missing lighting origin.
modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"lightingorigin" "stage_2_bridge"
	}
	delete:
	{
		"lightingorigin" "stage_2_bridge"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"lightingorigin" "stage_2_lightinf"
	}
	delete:
	{
		"lightingorigin" "stage_2_lightinf"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"lightingorigin" "stage_3_info_lighting"
	}
	delete:
	{
		"lightingorigin" "stage_3_info_lighting"
	}
}

; Don't try to pick more cases.
modify:
{
	match:
	{
		"classname" "logic_timer"
		"targetname" "stage_5_lower_timer_bridges"
	}
	delete:
	{
		"OnTimer" "stage_5_lower_timer_bridges_casePickRandomShuffle0-1"
	}
	insert:
	{
		"OnTimer" "stage_5_lower_timer_bridges_case,PickRandom,,,4"
	}
}

modify:
{
	match:
	{
		"classname" "logic_timer"
		"targetname" "stage_5_lower_timer"
	}
	delete:
	{
		"OnTimer" "stage_5_lower_door_casePickRandomShuffle0-1"
	}
	insert:
	{
		"OnTimer" "stage_5_lower_door_case,PickRandom,,,3"
	}
}

; Kill stage 5 door relays when pressed.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "/stage_5_((we|ea)st|south)_survivors_tr/"
	}
	replace:
	{
		"spawnflags" "1"
	}
	delete:
	{
		"OnTrigger" "!selfKill0.5-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_x_reward_vehicle_with_weapons_relay"
	}
	replace:
	{
		"spawnflags" "1"
	}
	delete:
	{
		"OnTrigger" "!selfEnable0-1"
	}
}

; Make sure "NPC" items spawn in correct order.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_west_survivors_tr"
	}
	delete:
	{
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 968 -4288 98640-1"
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 944 -4520 98640.1-1"
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 968 -4688 98640.2-1"
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 952 -4832 98640.3-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.31-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.21-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.11-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.01-1"
	}
	insert:
	{
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,968 -4288 9864,,1"
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,944 -4520 9864,,1"
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,968 -4688 9864,,1"
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,952 -4832 9864,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_south_survivors_tr"
	}
	delete:
	{
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 4872 -8264 98640-1"
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 4320 -8256 98640.1-1"
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 4184 -8296 98640.2-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.21-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.11-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.01-1"
	}
	insert:
	{
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,4872 -8264 9864,,1"
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,4320 -8256 9864,,1"
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,4184 -8296 9864,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_east_survivors_tr"
	}
	delete:
	{
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 8248 -4368 98640-1"
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 8296 -4576 98640.1-1"
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 8248 -4736 98640.2-1"
		"OnTrigger" "Weapon_NPC_TemplateAddOutputorigin 8288 -4872 98640.3-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.31-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.21-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.11-1"
		"OnTrigger" "Weapon_NPC_TemplateForceSpawn0.01-1"
	}
	insert:
	{
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,8248 -4368 9864,,1"
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,8296 -4576 9864,,1"
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,8248 -4736 9864,,1"
		"OnTrigger" "Weapon_NPC_Template,ForceSpawn,,,1"
		"OnTrigger" "Weapon_NPC_Template,SetLocalOrigin,8288 -4872 9864,,1"
	}
}

; "NPC" item fixes.
modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "Weapon_NPC_Body"
	}
	replace:
	{
		"spawnflags" "15003648"
	}
	delete:
	{
		"OnBreak" "Weapon_NPC_ModelClearParent0-1"
	}
	insert:
	{
		"OnBreak" "Weapon_NPC_Model,ClearParent,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "NPC_Soldier_Body"
	}
	replace:
	{
		"spawnflags" "15003648"
	}
	delete:
	{
		"OnBreak" "NPC_Soldier_Anim_Die_CaseFireUser10-1"
		"OnUser1" "!selfKill0-1"
		"OnUser1" "NPC_Soldier_ModelKill0-1"
		"OnUser1" "NPC_Soldier_Anim_Die_CaseKill0-1"
		"OnUser1" "NPC_Soldier_Anim_CaseKill0-1"
		"OnUser1" "NPC_Soldier_Sound_FireKill0.1-1"
		"OnUser1" "NPC_Soldier_Sound_FireVolume00-1"
	}
	insert:
	{
		"OnBreak" "NPC_Soldier_Model,SetAnimation,deathpose_lowviolence,,1"
		"OnBreak" "NPC_Soldier_Model,SetDefaultAnimation,,,1"
		"OnBreak" "item1human1soldier1model1,Kill,,,1"
		"OnBreak" "NPC_Soldier_Fire,Kill,,,1"
		"OnBreak" "NPC_Soldier_Grenade_Maker,Kill,,,1"
		"OnBreak" "NPC_Soldier_Area_Grenade,Kill,,,1"
		"OnBreak" "NPC_Soldier_Area_Gun,Kill,,,1"
		"OnBreak" "NPC_Soldier_Sound_Fire,Kill,,,1"
		"OnBreak" "NPC_Soldier_Sound_Fire,StopSound,,,1"
		"OnUser1" "NPC_Soldier_Model,KillHierarchy,,,1"
		"OnUser1" "NPC_Soldier_Sound_Fire,Kill,,,1"
		"OnUser1" "NPC_Soldier_Sound_Fire,StopSound,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "NPC_Soldier_Area_Gun"
	}
	delete:
	{
		"OnStartTouch" "NPC_Soldier_ModelFireUser20-1"
	}
	insert:
	{
		"OnStartTouchAll" "NPC_Soldier_Model,FireUser2,,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "NPC_Soldier_Model"
		"origin" "-254.87 10754.9 -8566"
	}
	replace:
	{
		"DefaultAnim" "rom"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "NPC_Soldier_Fire"
	}
	delete:
	{
		"OnUser2" "NPC_Soldier_Anim_CasePickRandom0-1"
	}
	insert:
	{
		"OnUser2" "NPC_Soldier_Model,SetAnimation,rom,,-1"
		"OnUser2" "NPC_Soldier_Model,SetDefaultAnimation,rom,,-1"
	}
}

filter:
{
	"classname" "logic_case"
	"targetname" "/NPC_Soldier_Anim_(Die_|)Case/"
}

; Attach weapon to "NPC" item correctly.
modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "NPC_Soldier_Template"
	}
	delete:
	{
		"Template04" "NPC_Soldier_Anim_Case"
	}
	replace:
	{
		"Template03" "item1human1soldier1model1"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "NPC_Soldier_Model"
		"origin" "-245 10744 -8510.54"
	}
	replace:
	{
		"classname" "prop_dynamic_ornament"
		"targetname" "item1human1soldier1model1"
	}
	insert:
	{
		"InitialOwner" "NPC_Soldier_Model"
	}
}

; Fix some semi-transparent item models.
modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "Weapon_Inmunizer_Model"
	}
	replace:
	{
		"rendermode" "0"
		"renderamt" "255"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_deagle"
		"targetname" "Weapon_Inmunizer_Weapon"
	}
	insert:
	{
		"OnPlayerPickup" "Weapon_Inmunizer_Model,AddOutput,rendermode 2,,1"
		"OnPlayerPickup" "Weapon_Inmunizer_Model,Alpha,254,,1"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "Weapon_Turbo_Device_Model"
	}
	replace:
	{
		"rendermode" "0"
		"renderamt" "255"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "Zombie_Item_Predator_Model"
	}
	replace:
	{
		"rendermode" "0"
		"renderamt" "255"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Predator_Knife"
	}
	insert:
	{
		"OnPlayerPickup" "Zombie_Item_Predator_Model,AddOutput,rendermode 2,,1"
		"OnPlayerPickup" "Zombie_Item_Predator_Model,Alpha,254,,1"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "Weapon_NPC_Model"
	}
	replace:
	{
		"rendermode" "0"
		"renderamt" "255"
		"DefaultAnim" "knife_aim_idle"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_deagle"
		"targetname" "Weapon_NPC_Weapon"
	}
	insert:
	{
		"OnPlayerPickup" "Weapon_NPC_Model,AddOutput,rendermode 2,,1"
		"OnPlayerPickup" "Weapon_NPC_Model,Alpha,254,,1"
	}
}

; Better knife strip system.
filter:
{
	"classname" "trigger_multiple"
	"targetname" "Zombie_Item_Predator_Knife_Trigger"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Predator_Template"
	}
	replace:
	{
		"Template10" "Zombie_Item_Predator_Knife"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Predator_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Predator_Knife_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_once"
	"targetname" "Zombie_Item_Antlion_Trigger"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Antlion_Template"
	}
	delete:
	{
		"Template07" "Zombie_Item_Antlion_Trigger"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Antlion_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Antlion_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "Zombie_Item_Tank_Disarmer"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Tank_Spawn"
	}
	delete:
	{
		"Template02" "Zombie_Item_Tank_Disarmer"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Tank_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Tank_DisarmerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "Zombie_Item_Vortigaunt_Trigger"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Vortigaunt_Template"
	}
	delete:
	{
		"Template04" "Zombie_Item_Vortigaunt_Trigger"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Vortigaunt_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Vortigaunt_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "Zombie_Item_Alma_Trigger"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Alma_Template"
	}
	delete:
	{
		"Template06" "Zombie_Item_Alma_Trigger"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Alma_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Alma_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "Zombie_Item_Summoner_Trigger"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Summoner_Template"
	}
	delete:
	{
		"Template05" "Zombie_Item_Summoner_Trigger"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Summoner_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Summoner_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "Zombie_Item_Jumper_Trigger"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Jumper_Template"
	}
	delete:
	{
		"Template08" "Zombie_Item_Jumper_Trigger"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Jumper_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Jumper_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "Zombie_Item_Shockwave_Trigger"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Shockwave_Template"
	}
	delete:
	{
		"Template08" "Zombie_Item_Shockwave_Trigger"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Shockwave_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Shockwave_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "Zombie_Item_Freezer_Trigger"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Freezer_Template"
	}
	delete:
	{
		"Template03" "Zombie_Item_Freezer_Trigger"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Freezer_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Zombie_Item_Freezer_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1,CallScriptFunction,CheckKnifeStrip,,-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "wpn_jugger_strip"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "temp_jugger"
	}
	delete:
	{
		"Template12" "wpn_jugger_strip"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "wpn_jugger"
	}
	delete:
	{
		"OnPlayerPickup" "wpn_jugger_stripKill01"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1RunScriptCodeCheckKnifeStrip(1);-1"
	}
}

filter:
{
	"classname" "trigger_multiple"
	"targetname" "Human_Item_Mech_Trigger"
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Human_Item_Mech_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "Human_Item_Mech_TriggerKill0-1"
	}
	insert:
	{
		"OnCacheInteraction" "map1manager1RunScriptCodeCheckKnifeStrip(2);-1"
	}
}

; Make stage 1 vehicles move to their position in extreme earlier.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Extreme_Stage_1"
	}
	delete:
	{
		"OnTrigger" "Stage_x_Spawn_Tank_Teleport_2Teleport4-1"
		"OnTrigger" "v_model1EnableMotion2.1-1"
		"OnTrigger" "v_model1DisableMotion4-1"
	}
	insert:
	{
		"OnTrigger" "Stage_x_Spawn_Tank_Teleport_2,Teleport,,,1"
		"OnTrigger" "v_model1,EnableMotion,,,1"
		"OnTrigger" "v_model1,DisableMotion,,2,1"
	}
}

; Make stage 5 truck entity non-solid.
modify:
{
	match:
	{
		"classname" "func_tracktrain"
		"targetname" "stage_x_reward_vehicle_with_weapons"
	}
	insert:
	{
		"effects" "32"
	}
	replace:
	{
		"spawnflags" "779"
	}
}

; Make sure stage 5 door can only be selected to open if its event is unlocked, fix buttons and make "Tank" vehicle only spawn when button is pressed and make it human only for the first 10 seconds.
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "stage_5_lower_door_case"
	}
	delete:
	{
		"OnCase01" "stage_5_lower_door_relay_reinforcements_1Trigger0-1"
		"OnCase02" "stage_5_lower_door_relay_reinforcements_5Trigger0-1"
		"OnCase03" "stage_5_lower_door_relay_reinforcements_7Trigger0-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "/stage_5_lower_door_relay_reinforcements_(1|5|7)/"
	}
	replace:
	{
		"StartDisabled" "0"
	}
}

; Kill stage 5 door relays when pressed.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_west_survivors_tr"
	}
	replace:
	{
		"spawnflags" "1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Case_Events_Stage_5"
		"origin" "-4256 11256 -8552"
	}
	delete:
	{
		"OnCase13" "stage_5_lower_door_relay_reinforcements_1Enable21"
	}
	insert:
	{
		"OnCase13" "stage_5_lower_door_case,AddOutput,OnCase01 stage_5_lower_door_relay_reinforcements_1:Trigger:::1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "/stage_5_lower_door_button_(1|5)/"
	}
	replace:
	{
		"spawnflags" "3073"
	}
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Case_Events_Stage_5"
		"origin" "-4272 11224 -8552"
	}
	delete:
	{
		"OnCase01" "stage_x_lower_door_5AddOutputOnFullyOpen Spawn_Tank_Teleport_stage_5:Teleport::0:121"
		"OnCase01" "stage_x_lower_door_5AddOutputOnFullyOpen v_model1:EnableMotion::0.1:121"
		"OnCase01" "stage_x_lower_door_5AddOutputOnFullyOpen v_model1:DisableMotion::2:121"
		"OnCase04" "stage_5_lower_door_relay_reinforcements_5Enable21"
		"OnCase07" "stage_5_lower_door_relay_reinforcements_7Enable21"
	}
	insert:
	{
		"OnCase01" "stage_5_lower_door_button_5,AddOutput,OnPressed Spawn_Tank_Teleport_stage_5:Teleport:::1,,1"
		"OnCase01" "stage_5_lower_door_button_5,AddOutput,OnPressed v_button1:RunScriptCode:function InputUse() { return false; }::1,,1"
		"OnCase01" "stage_5_lower_door_button_5,AddOutput,OnPressed v_model1:EnableMotion:::1,,1"
		"OnCase01" "stage_5_lower_door_button_5,AddOutput,OnPressed v_model1:DisableMotion::2:1,,1"
		"OnCase01" "stage_5_lower_door_button_5,AddOutput,OnPressed v_button1:RunScriptCode:function InputUse() { return activator.GetTeam() == 3; }:2:1,,1"
		"OnCase01" "stage_5_lower_door_button_5,AddOutput,OnPressed v_button1:RunScriptCode:delete InputUse;:10:1,,1"
		"OnCase04" "stage_5_lower_door_case,AddOutput,OnCase02 stage_5_lower_door_relay_reinforcements_5:Trigger:::1,,1"
		"OnCase07" "stage_5_lower_door_case,AddOutput,OnCase03 stage_5_lower_door_relay_reinforcements_7:Trigger:::1,,1"
	}
}

; Fix input of "All Events Unlocked" text.
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Mode_Supreme_Compare"
	}
	delete:
	{
		"OnGreaterThan" "Global_GameText_AnnouncementFireUser451"
	}
	insert:
	{
		"OnGreaterThan" "Global_GameText_Announcement,FireUser4, ,5,1"
	}
}

; Fix broken music in stage 5 "Solo Ending".
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_extreme_relay"
	}
	replace:
	{
		"spawnflags" "1"
	}
	delete:
	{
		"OnTrigger" "music_master_ambient_exAddOutputmusic/extreme_new_new/e_stage_5_end_good_2_extra.mp30.11"
	}
	insert:
	{
		"OnTrigger" "music_master_ambient_ex,AddOutput,message music/extreme_new_new/e_stage_5_end_good_2_extra.mp3,.01,1"
	}
}

; Fix "Antlion" item user being able to exploit on stage 5.
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_5_liftteleport1"
	"origin" "4592 -4600 10904"
	"spawnflags" "1"
	"model" "*33"
	"filtername" "team_filter_zombies"
	"wait" "1e30"
	"OnStartTouch" "!activator,SetLocalOrigin,4688 -2032 11184,,-1"
}

modify:
{
	match:
	{
		"classname" "filter_activator_team"
		"targetname" "stage_5_core_column_end_button_blue"
	}
	insert:
	{
		"OnUser1" "stage_5_liftteleport1,Kill,,3,1"
	}
}

; Fix stage 5 hint entity getting killed early and not showing rest of the texts.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_core_hit_relay"
	}
	delete:
	{
		"OnUser4" "stage_5_end_hintKill01"
	}
}

; The manager entity.
; This change requires having the "lms1main1.nut" file placed inside "scripts/vscripts/gfl" folder.
add:
{
	"classname" "info_target"
	"targetname" "map1manager1"
	"vscripts" "gfl/lms1main1"
	"thinkfunction" "Think"
	"OnUser1" "BigNet,Kill,,,1"
	"OnUser1" "commentary_semaphore,Kill,,,1"
}

; Add bias towards events and stage 5 damage for selecting the last man in stage 5 and prevent same person being selected twice.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_top_relay_core_working"
	}
	insert:
	{
		"OnTrigger" "map1manager1,CallScriptFunction,StopTrackingZombieDamage,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Stage_End_Stage_5"
	}
	insert:
	{
		"OnTrigger" "map1manager1,CallScriptFunction,Stage5Ended,,1"
	}
}

; Events.
modify:
{
	match:
	{
		"classname" "weapon_deagle"
		"targetname" "/Weapon_(M(utator|60|ine)|T(hundergun|urret)|Inmunizer|PortalGun|Gauss|ZeroGravity|Extra_(Inmunizer|Unlimmited))_Weapon|Spawn_Fuel_Gun/"
	}
	insert:
	{
		"OnPlayerPickup" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_glock"
		"targetname" "/(Weapon_Turbo|NPC_Train_Driver)_Weapon/"
	}
	insert:
	{
		"OnPlayerPickup" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "/Human_Item_Mech_Knife|wpn_jugger/"
	}
	insert:
	{
		"OnPlayerPickup" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "/stage_(x_(btn_end|part_4_explosion_button)|1_(b(utton_tower_top|ridge_button)|road_button_alternative_path)|2_(minifier_button|b(tn_main|utton_(weapon_door|factory_control|core_(factory|generator)))|escape_trigger))/"
	}
	insert:
	{
		"OnPressed" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "/stage_(3_(button_lock(_[2-6]|)|corridor_button_3x|core_button)|4_(part_3_button|end_button_protection)|5_lower_door_button_(1|5|7|LIFT))/"
	}
	insert:
	{
		"OnPressed" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_1_extratrigger1"
	}
	insert:
	{
		"OnTrigger" "stage_1_base_button_4,AddOutput,OnPressed map1manager1:CallScriptFunction:PlayerCompletedEvent::1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_physbox"
		"targetname" "stage_x_end_door_breakable"
	}
	replace:
	{
		"classname" "func_physbox_multiplayer"
		"spawnflags" "15003648"
	}
	insert:
	{
		"OnBreak" "map1manager1RunScriptCodePlayerCompletedEvent(_.driver1);1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_1_cargo_heli_trigger"
	}
	insert:
	{
		"OnTrigger" "map1manager1RunScriptCodePlayerCompletedEvent(_.driver1);1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "/stage_3_tests_relay_([1-2]|[5-6])/"
	}
	insert:
	{
		"OnTrigger" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Human_Item_Mech_Teleportation"
	}
	insert:
	{
		"OnTrigger" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "/stage_4_mech_(rocket(_flame|)|minigun)/"
	}
	insert:
	{
		"OnTrigger" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "/stage_nuke_inmuzer[1-3]/"
	}
	insert:
	{
		"OnStartTouch" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "filter_activator_team"
		"targetname" "/tank_who_entered|stage_(3_buton_filter|5_top_sync_button_((nor|sou)th|(ea|we)st)_filter)/"
	}
	insert:
	{
		"OnPass" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

modify:
{
	match:
	{
		"classname" "filter_activator_team"
		"targetname" "Vehicle_Car1_Test"
	}
	insert:
	{
		"OnFail" "map1manager1,CallScriptFunction,PlayerCompletedEvent,,1"
	}
}

; Add text for showing your stats on events.
add:
{
	"classname" "game_text"
	"targetname" "map1statstext1"
	"y" ".2"
	"x" "-1"
	"channel" "5"
	"color" "255 255 0"
	"color2" "128 128 0"
	"effect" "2"
	"fadein" ".05"
	"fadeout" "1"
	"fxtime" ".5"
	"holdtime" "2"
}

add:
{
	"classname" "info_game_event_proxy"
	"targetname" "map1eventgenerator1"
	"event_name" "player_info"
}

add:
{
	"classname" "logic_eventlistener"
	"targetname" "map1eventlistener1"
	"EventName" "player_connect"
	"FetchEventData" "1"
	"IsEnabled" "1"
	"TeamNum" "-1"
}

add:
{
	"classname" "logic_eventlistener"
	"targetname" "map1eventlistener2"
	"EventName" "player_activate"
	"FetchEventData" "1"
	"IsEnabled" "1"
	"TeamNum" "-1"
}

add:
{
	"classname" "logic_eventlistener"
	"targetname" "map1eventlistener3"
	"EventName" "player_say"
	"FetchEventData" "1"
	"IsEnabled" "1"
	"TeamNum" "-1"
}

add:
{
	"classname" "logic_eventlistener"
	"targetname" "map1eventlistener4"
	"EventName" "player_info"
	"FetchEventData" "1"
	"IsEnabled" "1"
	"TeamNum" "-1"
}

add:
{
	"classname" "logic_eventlistener"
	"targetname" "map1eventlistener5"
	"EventName" "player_disconnect"
	"FetchEventData" "1"
	"IsEnabled" "1"
	"TeamNum" "-1"
}

add:
{
	"classname" "logic_eventlistener"
	"targetname" "map1eventlistener6"
	"EventName" "player_hurt"
	"FetchEventData" "1"
	"IsEnabled" "1"
	"TeamNum" "2"
}

; Add kill credit and kill icons.
add:
{
	"classname" "point_hurt"
	"targetname" "map1takedamage1"
	"DamageTarget" "map1takedamagevictim1"
	"DamageRadius" ".01"
	"Damage" ".01"
	"DamageDelay" ".01"
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Weapon_Turret_Deployed_DevBrush"
	}
	replace:
	{
		"damagecap" "0"
		"damage" "0"
	}
	delete:
	{
		"OnStartTouch" "Weapon_Turret_Deployed_FireSoundVolume00-1"
		"OnStartTouch" "Weapon_Turret_Deployed_FireSoundVolume100.01-1"
		"OnStartTouch" "Weapons_Turret_Model_ParticleStart0-1"
		"OnStartTouch" "Weapons_Turret_Model_ParticleStop0.1-1"
	}
	insert:
	{
		"OnHurtPlayer" "map1manager1RunScriptCodeTakeDamage(3000, 0, _.dronegun, _.player_turret_carrier);-1"
		"OnHurtPlayer" "Weapon_Turret_Deployed_FireSound,PlaySound,,,-1"
		"OnHurtPlayer" "Weapons_Turret_Model_Particle,Start,,,-1"
		"OnHurtPlayer" "Weapons_Turret_Model_Particle,Stop,,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Weapon_Mine_HasAmmo"
	}
	insert:
	{
		"OnTrigger" "!activatorRunScriptCodeEntities.FindByName(null, _.Weapon_Mine_Projectile_Model + strTemplateWildcard).SetOwner(self);.01-1"
	}
}

modify:
{
	match:
	{
		"classname" "prop_dynamic"
		"targetname" "Weapon_Mine_Projectile_Model"
	}
	insert:
	{
		"OnUser4" "Spawn_Explosion_Small_Damage&*,AddOutput,OnStartTouch !self:FireUser1::-1,.03,1"
		"OnUser4" "!selfRunScriptCodeEntities.FindByName(null, _.Spawn_Explosion_Small_Damage + strTemplateWildcard).SetOwner(self.GetOwner());.031"
		"OnUser4" "Spawn_Explosion_Small_Damage&*,AddOutput,damage 0,.03,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Weapon_Gauss_Hurt"
	}
	replace:
	{
		"classname" "trigger_multiple"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "512"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "20000"
	}
	insert:
	{
		"wait" "1e30"
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(activator.GetHealth(), 512, _.zone_repulsor);-1"
	}
}

modify:
{
	match:
	{
		"classname" "weapon_deagle"
		"targetname" "Weapon_M60_Weapon"
	}
	insert:
	{
		"OnPlayerPickup" "!activatorRunScriptCodeEntities.FindByName(null, _.Weapon_Mounted_Gun_Hurt + strTemplateWildcard).SetOwner(self);-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Weapon_Mounted_Gun_Hurt"
	}
	replace:
	{
		"classname" "trigger_multiple"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "512"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "100"
	}
	insert:
	{
		"wait" "1e30"
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(100, 512, _.m249, caller.GetOwner());-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Zombie_Item_Predator_Plasma_Relay"
	}
	replace:
	{
		"spawnflags" "1"
		"StartDisabled" "1"
	}
	delete:
	{
		"OnSpawn" "Zombie_Item_Predator_Plasma_PhyFireUser12-1"
	}
	insert:
	{
		"OnSpawn" "Zombie_Item_Predator_Plasma_Phy,KillHierarchy,,2,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Zombie_Item_Predator_Plasma_Hurt"
	}
	replace:
	{
		"classname" "trigger_once"
	}
	delete:
	{
		"nodmgforce" "0"
		"Damagetype" "0"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "50"
		"OnHurt" "Zombie_Item_Predator_Plasma_PhyFireUser10-1"
	}
	insert:
	{
		"parentname" "Zombie_Item_Predator_Plasma_Phy"
		"OnTrigger" "map1manager1RunScriptCodeTakeDamage(25, 0, _.zone_repulsor, _.zombie_predator);1"
		"OnTrigger" "Zombie_Item_Predator_Plasma_Phy,KillHierarchy,,,1"
		"OnTrigger" "Zombie_Item_Predator_Thruster,Kill,,,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "Zombie_Item_Predator_Plasma_Phy"
	}
	replace:
	{
		"spawnflags" "14966784"
		"health" "9999"
		"minhealthdmg" "9999"
		"nodamageforces" "1"
	}
	delete:
	{
		"OnUser1" "Zombie_Item_Predator_Plasma_ThrusterKill0-1"
		"OnUser1" "Zombie_Item_Predator_Plasma_RelayKill0-1"
		"OnUser1" "Zombie_Item_Predator_Plasma_MeasureKill0-1"
	}
	insert:
	{
		"effects" "32"
		"OnDamaged" "!self,KillHierarchy,,,1"
		"OnDamaged" "Zombie_Item_Predator_Thruster,Kill,,,1"
	}
}

filter:
{
	"classname" "logic_measure_movement"
	"targetname" "Zombie_Item_Predator_Plasma_Measure"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "Zombie_Item_Predator_Plasma_Template"
	}
	delete:
	{
		"Template06" "Zombie_Item_Predator_Plasma_Measure"
	}
}

modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Zombie_Item_Predator_Suicide_2"
	}
	insert:
	{
		"OnLessThan" "!activatorRunScriptCodeif (self.GetTeam() == 2) EntFireByHandle(caller, _.FireUser1, __, -1, self, null);1"
		"OnUser1" "Spawn_Nuke_Hurt&*,AddOutput,OnStartTouch !self:FireUser1:::-1,7.01,1"
		"OnUser1" "!activatorRunScriptCodeEntities.FindByName(null, _.Spawn_Nuke_Hurt + strTemplateWildcard).SetOwner(self);7.011"
		"OnUser1" "!activatorRunScriptCodeEntities.FindByName(Entities.FindByName(null, _.Spawn_Nuke_Hurt + strTemplateWildcard), _.Spawn_Nuke_Hurt + strTemplateWildcard).SetOwner(self);7.011"
		"OnUser1" "Spawn_Nuke_Hurt&*,AddOutput,damage 0,7.01,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Spawn_Nuke_Hurt"
	}
	replace:
	{
		"StartDisabled" "1"
	}
	insert:
	{
		"OnUser1" "map1manager1RunScriptCodeTakeDamage(activator.GetHealth(), 0, _.prop_exploding_barrel, caller.GetOwner());-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Spawn_Nuke_Trigger"
	}
	insert:
	{
		"OnSpawn" "Spawn_Nuke_Hurt,Enable,,.01,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Zombie_Item_Tank_Hurt_Trigger"
	}
	replace:
	{
		"classname" "trigger_multiple"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "4"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "199"
	}
	insert:
	{
		"wait" "1e30"
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(99, 4, _.fists);-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Zombie_Item_Alma_Attack_Hurt_Relay"
	}
	delete:
	{
		"OnTrigger" "!activatorSetHealth-15-1"
	}
	insert:
	{
		"OnTrigger" "map1manager1RunScriptCodeTakeDamage(activator.GetHealth(), 0, _.Default, _.zombie_alma);5-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "/Spawn_Phy_Car_(2_|)Hurt/"
	}
	replace:
	{
		"classname" "trigger_multiple"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "0"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "2000"
	}
	insert:
	{
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(activator.GetHealth(), 1, _.Default, _.zombie_tank);-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "wpn_jugger_trigger"
	}
	replace:
	{
		"Damagetype" "0"
		"damagecap" "0"
		"damage" "0"
	}
	insert:
	{
		"OnHurt" "map1manager1RunScriptCodeTakeDamage(1000, 512, _.fists);-1"
		"OnHurtPlayer" "map1manager1RunScriptCodeTakeDamage(1000, 512, _.fists);-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "gatlingbullettimer"
	}
	insert:
	{
		"OnTrigger" "Spawn_Projectile_Physic&*,AddOutput,OnUser4 !self:FireUser1:::1,.01,-1"
		"OnTrigger" "!activatorRunScriptCodeEntities.FindByName(null, _.Spawn_Projectile_Physic + strTemplateWildcard).SetOwner(self);.01-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Human_Item_Mech_Hurt_Punch"
	}
	replace:
	{
		"classname" "trigger_multiple"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "512"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "2000"
	}
	insert:
	{
		"wait" "1e30"
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(1000, 512, _.fists, caller.GetMoveParent().GetMoveParent().GetOwner());-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Human_Item_Mech_Hurt_Fire"
	}
	replace:
	{
		"Damagetype" "0"
		"damagecap" "0"
		"damage" "0"
	}
	insert:
	{
		"OnHurt" "map1manager1RunScriptCodeTakeDamage(275, 512, _.inferno, caller.GetMoveParent().GetMoveParent().GetMoveParent().GetOwner());-1"
		"OnHurtPlayer" "map1manager1RunScriptCodeTakeDamage(275, 512, _.inferno, caller.GetMoveParent().GetMoveParent().GetMoveParent().GetOwner());-1"
		"OnHurtPlayer" "!activator,IgniteLifetime,3,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Human_Item_Mech_Hurt_Minigun"
	}
	replace:
	{
		"Damagetype" "0"
		"damagecap" "0"
		"damage" "0"
	}
	insert:
	{
		"OnHurt" "map1manager1RunScriptCodeTakeDamage(150, 512, _.m249, caller.GetMoveParent().GetMoveParent().GetMoveParent().GetOwner());-1"
		"OnHurtPlayer" "map1manager1RunScriptCodeTakeDamage(150, 512, _.m249, caller.GetMoveParent().GetMoveParent().GetMoveParent().GetOwner());-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Human_Item_Mech_Attack_Rocketlauncher"
	}
	insert:
	{
		"OnEqualTo" "Spawn_Projectile_Physic&*,AddOutput,OnUser4 !self:FireUser2:::1,1.21,-1"
		"OnEqualTo" "!activatorRunScriptCodeEntities.FindByName(null, _.Spawn_Projectile_Physic + strTemplateWildcard).SetOwner(self);1.21-1"
	}
}

modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "Spawn_Projectile_Physic"
	}
	insert:
	{
		"OnUser1" "Spawn_Explosion_Small_Damage&*,AddOutput,OnStartTouch !self:FireUser1:::-1,.03,1"
		"OnUser1" "!selfRunScriptCodeEntities.FindByName(null, _.Spawn_Explosion_Small_Damage + strTemplateWildcard).SetOwner(self.GetOwner());.031"
		"OnUser1" "Spawn_Explosion_Small_Damage&*,AddOutput,damage 0,.03,1"
		"OnUser1" "Spawn_Explosion_Small_Damage_H&*,AddOutput,OnStartTouch !self:FireUser1:::-1,.03,1"
		"OnUser1" "!selfRunScriptCodeEntities.FindByName(null, _.Spawn_Explosion_Small_Damage_H + strTemplateWildcard).SetOwner(self.GetOwner());.031"
		"OnUser1" "Spawn_Explosion_Small_Damage_H&*,AddOutput,damage 0,.03,1"
		"OnUser2" "Spawn_Explosion_Small_Damage&*,AddOutput,OnStartTouch !self:FireUser1:::-1,.03,1"
		"OnUser2" "!selfRunScriptCodeEntities.FindByName(null, _.Spawn_Explosion_Small_Damage + strTemplateWildcard).SetOwner(self.GetOwner());.031"
		"OnUser2" "Spawn_Explosion_Small_Damage&*,AddOutput,damage 0,.03,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Spawn_Explosion_Small_Damage"
	}
	insert:
	{
		"OnUser1" "map1manager1RunScriptCodeTakeDamage(activator.GetHealth(), 0, _.prop_exploding_barrel, caller.GetOwner());-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Spawn_Explosion_Small_Damage_H"
	}
	insert:
	{
		"OnUser1" "map1manager1RunScriptCodeTakeDamage(activator.GetHealth(), 0, _.prop_exploding_barrel, caller.GetOwner());-1"
	}
}

add:
{
	"classname" "filter_activator_name"
	"targetname" "map1nobossfilter1"
	"filtername" "zombie_boss"
	"Negated" "1"
}

add:
{
	"classname" "filter_multi"
	"targetname" "map1nononbosszombie1"
	"Filter01" "map1nobossfilter1"
	"Filter02" "team_filter_zombies"
	"Negated" "1"
}

modify:
{
	match:
	{
		"classname" "point_viewcontrol_multiplayer"
		"targetname" "stage_cinematic_cam"
	}
	delete:
	{
		"OnUser2" "playerSetDamageFilterfilter_no_zombies0-1"
	}
	insert:
	{
		"OnUser2" "playerRunScriptCodeif (self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.filter_no_zombies, -1, null, null);-1"
		"OnUser2" "map1manager1RunScriptCodebIsStage3Boss = true;-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Zombie_Item_Boss_Trigger_Hurt_Claws"
	}
	insert:
	{
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.map1nononbosszombie1, -1, null, null);.2-1"
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.filter_no_zombies, -1, null, null);.8-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Zombie_Item_Boss_Trigger_Hurt_Claws_Crouch"
	}
	insert:
	{
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.map1nononbosszombie1, -1, null, null);.6-1"
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.filter_no_zombies, -1, null, null);3-1"
	}
}

modify:
{
	match:
	{
		"classname" "info_particle_system"
		"targetname" "Zombie_Item_Boss_Stomp_Particle"
	}
	insert:
	{
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.map1nononbosszombie1, -1, null, null);-1"
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.filter_no_zombies, -1, null, null);.3-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Zombie_Item_Boss_Trigger_Hurt_Claws_2"
	}
	insert:
	{
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.map1nononbosszombie1, -1, null, null);.6-1"
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.filter_no_zombies, -1, null, null);1-1"
		"OnUser2" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.map1nononbosszombie1, -1, null, null);-1"
		"OnUser2" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.filter_no_zombies, -1, null, null);1.5-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Zombie_Item_Boss_Attach_Hurt_Explosion"
	}
	insert:
	{
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.map1nononbosszombie1, -1, null, null);1.2-1"
		"OnUser1" "playerRunScriptCodeif (bIsStage3Boss  && self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, _.filter_no_zombies, -1, null, null);1.4-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Zombie_Item_Boss_Trigger_Hurt_Claws"
	}
	replace:
	{
		"classname" "trigger_multiple"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "128"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "250"
	}
	insert:
	{
		"wait" "1e30"
		"filtername" "filter_no_zombies"
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(125, 128);-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "/Zombie_Item_Boss_Trigger_Hurt_Claws_(Crouch|2)/"
	}
	replace:
	{
		"classname" "trigger_multiple"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "128"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "3000"
	}
	insert:
	{
		"wait" "1e30"
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(activator.GetHealth(), 128);-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Zombie_Item_Boss_Attack_Case"
	}
	insert:
	{
		"OnCase03" "!activatorRunScriptCodeEntities.FindByName(null, _.SPawn_Mercer_Spikes_Hurt).SetOwner(self);1.01-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "SPawn_Mercer_Spikes_Relay"
	}
	insert:
	{
		"OnSpawn" "SPawn_Mercer_Spikes_Hurt,Enable,,.01,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "SPawn_Mercer_Spikes_Hurt"
	}
	replace:
	{
		"classname" "trigger_multiple"
		"StartDisabled" "1"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "128"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "1000"
	}
	insert:
	{
		"wait" "1e30"
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(activator.GetHealth(), 128, _.Default, caller.GetOwner());-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Zombie_Item_Boss_Attach_Hurt_Explosion"
	}
	replace:
	{
		"classname" "trigger_multiple"
	}
	delete:
	{
		"nodmgforce" "0"
		"damagetype" "128"
		"damagemodel" "0"
		"damagecap" "20"
		"damage" "170"
	}
	insert:
	{
		"wait" "1e30"
		"OnStartTouch" "map1manager1RunScriptCodeTakeDamage(85, 128, _.prop_exploding_barrel, caller.GetMoveParent().GetMoveParent().GetOwner());-1"
	}
}

modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "stage_x_boss_end_support_breakable_1"
	}
	insert:
	{
		"OnBreak" "Spawn_Explosion_Damage&*,AddOutput,OnStartTouch !self:FireUser1:::-1,.01,1"
		"OnBreak" "!activatorRunScriptCodeEntities.FindByName(null, _.Spawn_Explosion_Damage + strTemplateWildcard).SetOwner(self);.011"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Spawn_Explosion_Damage"
	}
	insert:
	{
		"OnUser1" "map1manager1RunScriptCodeTakeDamage(50000, 0, _.prop_exploding_barrel, caller.GetOwner());-1"
	}
}

; Replace "AddOutput basevelocity" inputs with "RunScriptCode SetVelocity".
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "Zombie_Item_Alma_Attack_Hurt"
	}
	delete:
	{
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 5000.05-1"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 500));-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "Weapon_ZeroGravity_Projectile_Trigger"
	}
	delete:
	{
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 -4900.07-1"
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 5000.05-1"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 500));-1"
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, -490));.5-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Zombie_Item_Boss_Attack_Case"
	}
	delete:
	{
		"OnCase03" "!activatorAddOutputbasevelocity 0 0 3000-1"
		"OnCase13" "!activatorAddOutputbasevelocity 0 0 4000-1"
	}
	insert:
	{
		"OnCase03" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 300));-1"
		"OnCase13" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 400));-1"
	}
}

filter:
{
	"classname" "filter_activator_team"
	"targetname" "team_filter_push_up"
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "Zombie_Item_Boss_Attack_Case"
	}
	delete:
	{
		"OnCase13" "playerAddOutputOnUser1 team_filter_push_up:TestActivator::0:10-1"
		"OnCase13" "playerFireUser10.8-1"
	}
	insert:
	{
		"OnCase13" "playerRunScriptCodeif (self.GetTeam() == 3 && self.GetHealth()) self.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 1000));.8-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "Zombie_Item_Boss_Gravity"
	}
	delete:
	{
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 -4700.07-1"
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 5000.05-1"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 500));-1"
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, -470));.5-1"
	}
}

; Nerf "Predator" item jump ability height a little.
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Zombie_Item_Predator_Jump"
	}
	delete:
	{
		"OnLessThan" "!activatorAddOutputbasevelocity 0 0 5000-1"
	}
	insert:
	{
		"OnLessThan" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 400));-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "/stage_5_Trap_Gravity_Trigger([3-4]|)/"
	}
	delete:
	{
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 5000.05-1"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 500));-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "/stage_2_trigger_minifier_room_[1-2]/"
	}
	delete:
	{
		"OnTrigger" "!activatorAddOutputbasevelocity 0 0 8000-1"
	}
	insert:
	{
		"OnTrigger" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 800));-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "Spawn_Nuke_Hurt"
	}
	delete:
	{
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 5000-1"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 500));-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_5_last_man_trigger_core_end_bad"
	}
	delete:
	{
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 -4850.07-1"
		"OnStartTouch" "!activatorAddOutputbasevelocity 0 0 5000.05-1"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, 500));-1"
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector(self.GetVelocity().x, self.GetVelocity().y, -485));.5-1"
	}
}

; Make stage 5 zombie teleports cover everywhere.
filter:
{
	"classname" "trigger_teleport"
	"targetname" "lms_fuckoffzombies"
}

; Optimize stage 5 "Last Man Standing" triggers and fix it killing the "Mech" user.
filter:
{
	"classname" "func_rotating"
	"targetname" "stage_5_last_man_rotating"
}

filter:
{
	"classname" "trigger_once"
	"targetname" "stage_5_last_man_detect"
}

filter:
{
	"classname" "filter_activator_name"
	"targetname" "filter_last_man_name_allow"
}

filter:
{
	"classname" "trigger_teleport"
	"targetname" "teleport_lastmanstanding"
}

filter:
{
	"classname" "filter_activator_name"
	"targetname" "filter_last_man_name"
}

filter:
{
	"classname" "filter_multi"
	"targetname" "filter_last_man"
}

filter:
{
	"classname" "trigger_hurt"
	"targetname" "stage_5_last_man_trigger"
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_core_destroyed"
	}
	replace:
	{
		"spawnflags" "1"
	}
	delete:
	{
		"vscripts" "hichatu/actual_random_solo.nut"
		"OnTrigger" "stage_5_last_man_detectEnable0-1"
	}
	insert:
	{
		"OnTrigger" "map1manager1,CallScriptFunction,PickLastManStanding,,1"
		"OnTrigger" "Human_Item_Mech_Model,KillHierarchy,,,1"
		"OnTrigger" "Human_Item_Mech_UI,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Attack_*,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Logic,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Timer,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Selector,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Walk,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Sound_*,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Explosion,Kill,,,1"
		"OnTrigger" "Mech_Particle_Teleportation,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Teleportation,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Hint,Kill,,,1"
		"OnTrigger" "stage_4_Human_Item_Mech_Hint_Telp,Kill,,,1"
		"OnTrigger" "human_item_mech_hurt_punch,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Cam,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Cam,Disable,,,1"
		"OnTrigger" "stage_x_juggernaut_*,Kill,,,1"
		"OnTrigger" "stage_4_juggernaut_escape_trigger,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_Show_Model,Kill,,,1"
		"OnTrigger" "stage_4_mech_*,Kill,,,1"
		"OnTrigger" "filter_mech,Kill,,,1"
		"OnTrigger" "Human_Item_Mech_KnifeRunScriptCodeif (!self.GetOwner()) self.Destroy();1"
		"OnTrigger" "human_mech,AddOutput,targetname ,,1"
		"OnTrigger" "human_mechRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);1"
		"OnTrigger" "human_mech,AddOutput,gravity 1,,1"
		"OnTrigger" "human_mech,AddOutput,health 100,,1"
		"OnTrigger" "human_mech,AddOutput,rendermode 0,,1"
		"OnTrigger" "human_mech,AddOutput,renderfx 0,,1"
		"OnTrigger" "human_mech,SetDamageFilter,,,1"
		"OnTrigger" "wpn_jugger_branch,Kill,,,1"
		"OnTrigger" "wpn_jugger_fx,Kill,,,1"
		"OnTrigger" "wpn_jugger_mdl,Kill,,,1"
		"OnTrigger" "wpn_jugger_phys,Kill,,,1"
		"OnTrigger" "wpn_jugger_relay_*,Kill,,,1"
		"OnTrigger" "wpn_jugger_hurt,Kill,,,1"
		"OnTrigger" "wpn_jugger_snd_*,Kill,,,1"
		"OnTrigger" "wpn_jugger_trigger,Kill,,,1"
		"OnTrigger" "wpn_jugger_ui,Kill,,,1"
		"OnTrigger" "item1human1juggernaut1multiple1,Kill,,,1"
		"OnTrigger" "item1human1juggernaut1multipledisabled1,Kill,,,1"
		"OnTrigger" "stage_5_dog_spawner,Kill,,,1"
		"OnTrigger" "wpn_juggerRunScriptCodeif (!self.GetOwner()) self.Destroy();1"
		"OnTrigger" "monsterRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);1"
		"OnTrigger" "monster,SetDamageFilter,,,1"
		"OnTrigger" "monster,AddOutput,rendermode 0,,1"
		"OnTrigger" "monster,AddOutput,renderfx 0,,1"
		"OnTrigger" "monster,AddOutput,renderamt 255,,1"
		"OnTrigger" "monster,AddOutput,health 100,,1"
		"OnTrigger" "last_man_standingRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);11"
		"OnTrigger" "last_man_standing,SetDamageFilter,,1,1"
		"OnTrigger" "last_man_standing,AddOutput,rendermode 0,1,1"
		"OnTrigger" "last_man_standing,AddOutput,renderfx 0,1,1"
		"OnTrigger" "last_man_standing,AddOutput,renderamt 255,1,1"
		"OnTrigger" "monster,AddOutput,targetname ,1,1"
		"OnTrigger" "monsterRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);11"
		"OnTrigger" "monster,SetDamageFilter,,1,1"
		"OnTrigger" "monster,AddOutput,rendermode 0,1,1"
		"OnTrigger" "monster,AddOutput,renderfx 0,1,1"
		"OnTrigger" "monster,AddOutput,renderamt 255,1,1"
		"OnTrigger" "last_man_standingRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);2.31"
		"OnTrigger" "human_mechRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);2.31"
		"OnTrigger" "last_man_standingRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);31"
		"OnTrigger" "human_mechRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);31"
	}
}

; Reset "Mech" item user's gravity when "Team Win Ending" is triggered.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_5_top_relay_core_working"
	}
	insert:
	{
		"OnTrigger" "human_mech,AddOutput,gravity 1,,1"
	}
}

; Fix "Mech" item setting speed of user to normal after doing attacks.
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Human_Item_Mech_Attack_Punch"
	}
	delete:
	{
		"OnEqualTo" "Global_SpeedModifySpeed12.3-1"
	}
	insert:
	{
		"OnEqualTo" "Global_Speed,ModifySpeed,.8,2.3,-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Human_Item_Mech_Attack_Rocketlauncher"
	}
	delete:
	{
		"OnEqualTo" "Global_SpeedModifySpeed13-1"
	}
	insert:
	{
		"OnEqualTo" "Global_Speed,ModifySpeed,.8,3,-1"
	}
}

modify:
{
	match:
	{
		"classname" "env_hudhint"
		"targetname" "Human_Item_Mech_Hint"
	}
	delete:
	{
		"OnUser1" "Human_Item_Mech_HintFireUser10.5-1"
	}
	insert:
	{
		"OnUser1" "Human_Item_Mech_Hint,FireUser1,,.01,-1"
	}
}

; Useless entity.
filter:
{
	"classname" "info_target"
	"targetname" "driver1"
}

; Make "270" angles to "90" cause why not.
modify:
{
	match:
	{
		"angles" "0 270 0"
	}
	replace:
	{
		"angles" "0 -90 0"
	}
}

; Turn "info_teleport_destination"s with no parent to "logic_relay", bless "Moltard".
modify:
{
	match:
	{
		"classname" "info_teleport_destination"
	}
	insert:
	{
		"hasparent" "0"
	}
}

modify:
{
	match:
	{
		"classname" "info_teleport_destination"
		"parentname" "/.*/"
	}
	replace:
	{
		"hasparent" "1"
	}
}

modify:
{
	match:
	{
		"hasparent" "0"
	}
	replace:
	{
		"classname" "logic_relay"
		"StartDisabled" "1"
	}
	delete:
	{
		"hasparent" "0"
	}
}

modify:
{
	match:
	{
		"hasparent" "1"
	}
	delete:
	{
		"hasparent" "1"
	}
}

; Fix "ModifySpeed" outputs.
modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "Zombie_Item_Predator_Health"
	}
	delete:
	{
		"OnBreak" "zombie_predatorAddOutputOnUser4 Global_Speed:ModifySpeed:0:0:10-1"
		"OnBreak" "zombie_predatorFireUser40.01-1"
	}
}

modify:
{
	match:
	{
		"classname" "env_entity_maker"
		"targetname" "Zombie_Item_Predator_Suicide_Maker"
	}
	delete:
	{
		"OnEntitySpawned" "zombie_predatorFireUser40.01-1"
		"OnEntitySpawned" "zombie_predatorAddOutputOnUser4 Global_Speed:ModifySpeed:0:0:10-1"
	}
}

modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "Human_Item_Mech_Body"
	}
	delete:
	{
		"OnBreak" "human_mechAddOutputOnUser1 Global_Speed:ModifySpeed:0:0:10-1"
		"OnBreak" "human_mechAddOutputOnUser1 Global_Speed:ModifySpeed:1:1.7:10-1"
	}
	insert:
	{
		"OnBreak" "human_mechRunScriptCodeEntFireByHandle(Entities.FindByName(null, _.Global_Speed), _.ModifySpeed, (1).tostring(), -1, self, null);1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "/stage_5_Trap_Gravity_Trigger([3-4]|)/"
	}
	delete:
	{
		"OnStartTouch" "Global_SpeedModifySpeed1.1510-1"
	}
	insert:
	{
		"OnStartTouch" "Global_Speed,ModifySpeed,1,10,-1"
	}
}

; Fix weapon item buttons not rotating.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "/Weapon_(Thundergun_Game|((M(utator|60|ine)|Tur(ret|bo_Device))|Inmunizer|PortalGun|Gauss|ZeroGravity|Extra_(Inmunizer|Unlimmited))_)UI/"
		"spawnflags" "19457"
	}
	replace:
	{
		"spawnflags" "3073"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "Weapon_Turret_Deployed_Button"
		"spawnflags" "17409"
	}
	replace:
	{
		"spawnflags" "1025"
	}
}

; Fix "Alma" item being able to be triggered when no human is inside her zone.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "Zombie_Item_Alma_Detector"
	}
	delete:
	{
		"OnStartTouch" "Zombie_Item_Alma_RelayEnable0-1"
	}
	insert:
	{
		"OnStartTouchAll" "Zombie_Item_Alma_Relay,Enable,,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Zombie_Item_Alma_Relay"
	}
	delete:
	{
		"OnTrigger" "!selfDisable0-1"
		"OnTrigger" "!selfEnable15-1"
	}
}

; Fix "Alma" item reverting humans back to wrong speed if they didn't die.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "Zombie_Item_Alma_Attack_Hurt"
	}
	delete:
	{
		"OnStartTouch" "Global_SpeedModifySpeed1.155-1"
	}
	insert:
	{
		"OnStartTouch" "Global_Speed,ModifySpeed,1,5,-1"
	}
}

; Fix stage 3 boss not being able to attack after being defeated, replace "movetype" inputs with speedmod, adjust some timings, fix "Boss" item animations, carry some outputs from "path_track" to here and don't lose the round if "Boss" item user disconnects.
modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "Zombie_Item_Boss_Knife"
	}
	delete:
	{
		"OnPlayerPickup" "!activatorSetDamageFilter0-1"
	}
	insert:
	{
		"OnPlayerPickup" "!activator,SetDamageFilter,filter_no_humans,,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "Zombie_Item_Boss_Trigger_Attack"
	}
	replace:
	{
		"wait" "1e30"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Zombie_Item_Boss_Normal_Transformation"
	}
	delete:
	{
		"OnTrigger" "!activatorAddOutputgravity 0.43-1"
		"OnTrigger" "Global_SpeedModifySpeed2.55-1"
		"OnTrigger" "Global_SpeedModifySpeed00-1"
		"OnTrigger" "Zombie_Item_Boss_Attack_SelectorDisable39-1"
		"OnTrigger" "Zombie_Item_Boss_Attack_CaseFireUser438-1"
		"OnTrigger" "!activatorAddOutputmovetype 00-1"
		"OnTrigger" "!activatorAddOutputmovetype 25-1"
	}
	insert:
	{
		"OnTrigger" "zombie_boss,AddOutput,gravity .4,5,1"
		"OnTrigger" "Global_Speed,ModifySpeed,0,,1"
		"OnTrigger" "Global_Speed,ModifySpeed,2.5,5,1"
		"OnTrigger" "Zombie_Item_Boss_Normal_UI,Kill,,40,1"
		"OnTrigger" "Zombie_Item_Boss_Attack_Selector,Kill,,40,1"
		"OnTrigger" "Zombie_Item_Boss_Attack_Case,Kill,,40,1"
		"OnTrigger" "Zombie_Item_Boss_Attack_Selected,Kill,,40,1"
		"OnTrigger" "Zombie_Item_Boss_Attack_Selected,HideHudHint,,40,1"
		"OnTrigger" "Zombie_Item_Boss_Trigger_Attack,Kill,,40,1"
		"OnTrigger" "Zombie_Item_Boss_CanDieRunScriptCodeif (!Entities.FindByName(null, _.zombie_boss)) EntFireByHandle(self, _.Enable, __, -1, null, null);42.981"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Zombie_Item_Boss_CanDie"
	}
	replace:
	{
		"spawnflags" "0"
	}
	delete:
	{
		"OnTrigger" "Global_GameText_AnnouncementRunScriptCodesetMessage(21)0-1"
		"OnTrigger" "Global_SpeedModifySpeed00-1"
		"OnTrigger" "Global_SpeedModifySpeed214-1"
		"OnTrigger" "Zombie_Item_Boss_Morphed_ModelSetDefaultAnimationrun9-1"
		"OnTrigger" "Zombie_Item_Boss_Morphed_ModelFireUser17-1"
		"OnTrigger" "zombie_bossAddOutputmovetype 00-1"
		"OnTrigger" "zombie_bossAddOutputmovetype 214-1"
		"OnTrigger" "zombie_bossRunScriptCodeforeach(k,_ in {Global_Speed_suppress=1}){foreach(v,__ in {ModifySpeed=1}){EntFire(k, v, '0'.tochar(), 0.0, self);}}0.11"
		"OnTrigger" "zombie_bossRunScriptCodeforeach(k,_ in {Global_Speed_suppress=1}){foreach(v,__ in {ModifySpeed=1}){EntFire(k, v, '0'.tochar(), 0.0, self);}}13.91"
	}
	insert:
	{
		"OnTrigger" "Global_Speed_suppress,ModifySpeed,0,,1"
		"OnTrigger" "!self,Kill,,,1"
		"OnTrigger" "!selfRunScriptCodeEntFireByHandle(self, _.FireUser + (Entities.FindByName(null, _.zombie_boss) ? 1 : 2), __, -1, null, null);1"
		"OnUser1" "Global_GameText_AnnouncementRunScriptCodesetMessage(21);1"
		"OnUser2" "Global_GameText_Announcement,SetText,** HE HAS LEFT! GO GO ESCAPE FROM THE LAB! **,,1"
		"OnTrigger" "Zombie_Item_Boss_Morphed_Model,SetDefaultAnimation,run,13,1"
		"OnTrigger" "Zombie_Item_Boss_Morphed_Model,FireUser1,,13,1"
		"OnTrigger" "zombie_boss,AddOutput,movetype 2,15,1"
		"OnTrigger" "Global_Speed,ModifySpeed,2,15,1"
		"OnTrigger" "Global_Speed_suppress,ModifySpeed,1,15,1"
	}
}

filter:
{
	"classname" "trigger_once"
	"targetname" "stage_3_end_teleport"
}

filter:
{
	"classname" "filter_multi"
	"targetname" "filter_no_boss_all_humans"
}

modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "stage_x_end_vehicle_escape_track_1"
	}
	delete:
	{
		"OnPass" "zombie_bossFireUser40.1-1"
		"OnPass" "Global_GameText_AnnouncementRunScriptCodesetMessage(21)0-1"
		"OnPass" "zombie_bossAddOutputOnUser4 Global_Speed:ModifySpeed:0::10-1"
		"OnPass" "zombie_bossAddOutputOnUser4 Global_Speed:ModifySpeed:1.7:14:10-1"
		"OnPass" "Global_GameText_AnnouncementFireUser40-1"
		"OnPass" "Zombie_Item_Boss_Morphed_ModelSetPlaybackRate00.1-1"
		"OnPass" "Zombie_Item_Boss_Morphed_ModelSetPlaybackRate112.1-1"
		"OnPass" "Zombie_Item_Boss_Attack_CaseAddOutputtargetname Zombie_Item_Boss_Attack_Deactivated0-1"
		"OnPass" "Zombie_Item_Boss_Attack_DeactivatedAddOutputtargetname Zombie_Item_Boss_Attack_Case13-1"
		"OnPass" "zombie_bossAddOutputmovetype 00-1"
		"OnPass" "zombie_bossAddOutputmovetype 214-1"
		"OnPass" "playerSetDamageFilter0.11"
	}
	insert:
	{
		"OnPass" "zombie_boss,AddOutput,movetype 0,,1"
		"OnPass" "playerRunScriptCodeif (self.GetTeam() == 3 && self.GetHealth()) EntFireByHandle(self, _.SetDamageFilter, __, -1, null, null);1"
		"OnPass" "map1manager1RunScriptCodebIsStage3Boss = false;1"
		"OnPass" "playerRunScriptCodeif (self.GetTeam() == 2 && self.GetName() != _.zombie_boss && self.GetHealth()) self.SetAbsOrigin(Vector(716, 1908, 1443));1"
	}
}

; Make "Boss" item breakable type "None", humans aren't metal.
modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "Zombie_Item_Boss_Super_Health"
	}
	replace:
	{
		"material" "10"
	}
}

; Show them how a real nothing filter is done.
modify:
{
	match:
	{
		"classname" "filter_activator_name"
		"targetname" "filter_nothing"
	}
	replace:
	{
		"classname" "filter_base"
		"Negated" "1"
	}
	delete:
	{
		"filtername" "nothing_etc"
		"OnFail" "!activatorSetHealth-10-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage5_zmratio"
	}
	replace:
	{
		"spawnflags" "1"
	}
	delete:
	{
		"vscripts" "hichatu/alternatezratio.nut"
		"OnTrigger" "consoleCommandzr_infect_mzombie_ratio 221"
		"OnTrigger" "!selfRunScriptCode//AlternateRatioSystem() - Stripper if needed21"
		"OnTrigger" "stage5_zmhpsetterEnable201"
	}
	insert:
	{
		"OnTrigger" "console,Command,zr_infect_mzombie_ratio 2,,1"
	}
}

filter:
{
	"classname" "logic_relay"
	"targetname" "stage5_zmhpsetter"
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Stage_Start_Stage_5"
	}
	insert:
	{
		"OnTrigger" "map1manager1RunScriptCodebDidZombiesSpawnOnStage5 = true;201"
		"OnTrigger" "game_playerdie,AddOutput,OnUse map1manager1:CallScriptFunction:DiedOnStage5::-1,20,1"
	}
}

; Handle it in a think function.
filter:
{
	"classname" "logic_timer"
	"targetname" "stage5_zmhpsetter"
}

; Fix early triggering nuke on stage 4.
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "stage_4_part_5_case_controller"
	}
	insert:
	{
		"OnCase03" "stage_4_part_5_trigger,Enable,,20,1"
		"OnCase03" "stage_4_end_buttonRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1201"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_4_part_5_trigger"
	}
	replace:
	{
		"StartDisabled" "1"
	}
	insert:
	{
		"OnTrigger" "stage_4_trigger_end,Enable,,10,1"
		"OnTrigger" "stage_4_end_buttonRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }601"
	}
}

; Move stage 4 end trigger back some units so it no longer sticks out of the wall.
modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_4_trigger_end"
	}
	replace:
	{
		"origin" "11408 -9200 3504"
		"StartDisabled" "1"
	}
	insert:
	{
		"OnTrigger" "stage_4_end_button*,Unlock,,,1"
		"OnTrigger" "stage_4_end_button_protection,AddOutput,OnDamaged !self:FireUser1:::1,,1"
		"OnTrigger" "stage_4_end_buttonRunScriptCodefunction InputUse() { local iTeam = activator.GetTeam(); if (iTeam == 2) EntFire(_.ZOMBIESTRIGGERED, _.Trigger); return iTeam == 3; }1"
	}
}

; Fix skipping over the oil tank in stage 4.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_4_teleport"
	}
	replace:
	{
		"origin" "4260 -707.5 5184"
		"wait" "1e30"
	}
	delete:
	{
		"model" "*715"
	}
}

; Kill the door on stage 4 when "Ultralisk" passes.
modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "stage_x_ultralistk_path_5"
	}
	insert:
	{
		"OnPass" "stage_4_part_6_door_1,Kill,,5,1"
	}
}

; Fix a huge skip in stage 4 involving jumping from plane's wing.
add:
{
	"classname" "func_reflective_glass"
	"targetname" "stage_4_custombrush1"
	"spawnflags" "2"
	"origin" "-2944 -4416 5344"
	"Solidity" "2"
	"solidbsp" "1"
}

; Make this door open to the other side.
modify:
{
	match:
	{
		"classname" "prop_door_rotating"
		"targetname" "stage_4_part_5_door_2"
	}
	replace:
	{
		"spawnflags" "2048"
	}
}

; Make stage 1 barrels not break the incorrect walls.
modify:
{
	match:
	{
		"classname" "prop_physics"
		"targetname" "stage_1_end_explosion_barrel_2"
	}
	delete:
	{
		"OnBreak" "stage_4_part_4_doorBreak0-1"
		"OnPlayerUse" "stage_1_wall_way2Break0-1"
	}
}

modify:
{
	match:
	{
		"classname" "prop_physics"
		"targetname" "stage_1_end_explosion_barrel"
	}
	delete:
	{
		"OnPlayerUse" "stage_x_end_door_breakableBreak0-1"
		"OnBreak" "stage_4_part_4_doorBreak0-1"
	}
	insert:
	{
		"OnBreak" "stage_x_end_door_breakable,Break,,,1"
	}
}

; Fix stage 4 train early trigger.
modify:
{
	match:
	{
		"classname" "weapon_glock"
		"targetname" "NPC_Train_Driver_Weapon"
	}
	delete:
	{
		"OnPlayerPickup" "NPC_Train_Driver_AreaFireUser101"
	}
}

modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "Vehicle_Fake_Truck_Path_Track_5"
	}
	insert:
	{
		"OnPass" "NPC_Train_Driver_Area,FireUser1,,,1"
	}
}

; Try a better system for "Train Driver" item holder slowdown on stage 4.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "NPC_Train_Driver_Weapon_Slower"
	}
	replace:
	{
		"wait" "1e30"
	}
	delete:
	{
		"OnTrigger" "Global_SpeedModifySpeed10.95-1"
		"OnTrigger" "Global_SpeedModifySpeed0.80-1"
	}
	insert:
	{
		"OnStartTouch" "Global_Speed,ModifySpeed,.8,,-1"
		"OnEndTouch" "Global_Speed,ModifySpeed,1,,-1"
	}
}

; Part of the above fix, but wanted to take a second here and admire the beautiful targetname.
modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
		"targetname" "CSGOFUCKFIX"
	}
	delete:
	{
		"OnUser3" "NPC_Train_Driver_Weapon_SlowerKill0-1"
	}
	insert:
	{
		"OnUser3" "NPC_Train_Driver_Weapon_Slower,Disable,,,1"
		"OnUser3" "NPC_Train_Driver_Weapon_Slower,Kill,,1,1"
	}
}
